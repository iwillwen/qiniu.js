!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.qiniu=t()}(this,function(){"use strict";function genOptUrl(e){var t="";return utils.each(e,function(e,n){t+=utils.format("/%s/%s",n,e)}),t}function noop$1(){return!1}function _Asset(e){return configData=e,Asset$1}function createXHR(){if(window.ActiveXObject)var e=new ActiveXObject("Microsoft.XMLHTTP");else if(window.XMLHttpRequest)var e=new XMLHttpRequest;return e}function genOptUrl$1(e){var t="";return utils.each(e,function(e,n){t+=utils.format("/%s/%s",n,e)}),t}function noop$3(){return!1}function noop$2(){return!1}function _Bucket(e){return globalConfig=e,Asset$2=_Asset(e),Bucket$1}function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(e){return"function"==typeof e}function isNumber(e){return"number"==typeof e}function isObject(e){return"object"===("undefined"==typeof e?"undefined":babelHelpers["typeof"](e))&&null!==e}function isUndefined(e){return void 0===e}function noop(){return!1}var babelHelpers={};babelHelpers["typeof"]="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},babelHelpers.classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},babelHelpers.createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),babelHelpers.inherits=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},babelHelpers.possibleConstructorReturn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t};var slice=[].slice,nativeForEach=[].forEach||!1,utils={slice:slice,noop:function(){return!1},inherits:function(e,t){e.super_=t,e.prototype=utils.objCreate(utils.objExtend(utils.objClone(t.prototype),{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))},isString:function(e){return"string"==typeof e},isObject:function(e){return e instanceof Object},isArray:function(e){return e instanceof Array},isFunction:function(e){return e instanceof Function},isUndefine:function(e){return void 0===e},objClone:function(e){return utils.isObject(e)?utils.isArray(e)?e.slice():utils.objExtend({},e):e},objExtend:function(e){for(var t=slice.call(arguments,1),n=0;n<t.length;n++)!function(n){var i=t[n];if(i)for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])}(n);return e},objCreate:function(e){function t(){}if(arguments.length>1)throw new Error("Object.create implementation only accepts the first parameter.");return t.prototype=e,new t},objKeys:function(e){if(utils.isFunction(e.key))return e.keys();var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t},each:function(e,t,n){if(null!=e)if(nativeForEach&&e.forEach===nativeForEach)e.forEach(t,n);else if(e.length===+e.length){for(var i=0,r=e.length;r>i;i++)if(t.call(n,e[i],i,e)===!1)return}else for(var a=utils.objKeys(e),i=0,r=a.length;r>i;i++)if(t.call(n,e[a[i]],a[i],e)===!1)return},format:function(e){if(!utils.isString(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(arguments[n]);return t.join(" ")}var i=slice.call(arguments,1),n=0,r=arguments.length,a=/%[sd%]/g,o=String(e).replace(a,function(e){if("%%"===e)return"%";if(n>=r)return e;switch(e){case"%s":return String(i[n++]);case"%d":return Number(i[n++]);default:return e}});return o},safeEncode:function(e){var t=btoa(e),n=t.replace(/\//g,"_").replace(/\+/g,"-");return n},css:function(e,t){if(e&&e.style){var n,i;for(n in t){i=t[n],"number"==typeof i&&(i+="px");try{e.style[n]=i}catch(r){}}}}},imageViewTranslations={weight:"w",height:"h",quality:"q"},Fop=function(){function e(t){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];babelHelpers.classCallCheck(this,e),this.parent=t,this.config=n,this.query=""}return babelHelpers.createClass(e,[{key:"fop",value:function(e){return this.query+="|"+e,this}},{key:"imageInfo",value:function(){return this.query+="|imageInfo",this}},{key:"exif",value:function(){return this.query+="|exif",this}},{key:"imageView",value:function(e){var t=e.mode;delete e.mode;var n=(this.url(),{});return utils.each(e,function(e,t){imageViewTranslations.hasOwnProperty(t)&&(t=imageViewTranslations[t]),n[t]=e}),this.query+=utils.format("|imageView/%d%s",t,genOptUrl(n)),this}},{key:"imageMogr",value:function(e){var t={};return utils.objExtend(t,e),this.query+=utils.format("|imageMogr/v2/auto-orient%s",genOptUrl(t)),this}},{key:"watermark",value:function(e){var t={},n=e.mode;return delete e.mode,utils.objExtend(t,e),t.image=utils.safeEncode(t.image),this.query+=utils.format("|watermark/%d%s",n,genOptUrl(t)),this}},{key:"qrcode",value:function(e){return e=e||{mode:0,level:"L"},this.query+=utils.format("|qrcode/%d/level/%s",this.url(),e.mode,e.level),this}},{key:"md2html",value:function(e){e=e||{mode:!1,css:!1};var t="|md2html";return e.css&&(t+=utils.format("/%s",e.mode)),e.css&&(t+=utils.format("/css/%s",utils.safeEncode(e.css))),this.query+=t,this}},{key:"url",value:function(){return utils.format("%s?%s",this.parent.url(),this.query.substr(1))}},{key:"image",value:function t(){var t=new Image;return t.src=this.url(),t}}]),e}(),configData={},Asset$1=function(){function e(t,n){var i=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];babelHelpers.classCallCheck(this,e),this.key=t,this.parent,this.config=i}return babelHelpers.createClass(e,[{key:"url",value:function(){return this.parent.url()+"/"+this.key}},{key:"entryUrl",value:function(){return utils.safeEncode(utils.format("%s:%s",this.parent.name,this.key))}},{key:"qrcode",value:function(e,t){switch(!0){case utils.isFunction(e):t=e,e={mode:0,level:"L"};break;case utils.isObject(e)&&utils.isUndefined(t):t=noop$1;break;case utils.isUndefined(e):e={mode:0,level:"L"},t=noop$1}var n=utils.format("%s?qrcode/%d/level/%s",this.url(),e.mode,e.level),i=new Image;return i.src=i.url=n,i}},{key:"fop",value:function(e){return new Fop(this,e)}},{key:"alias",value:function(e){var t=this.url();return t+=utils.format("%s%s",this.config.separate,e)}},{key:"md2html",value:function(e){utils.isFunction(e)?(callback=e,e={mode:!1,css:!1}):utils.isObject(e)?callback=callback||noop$1:(callback=callback||noop$1,e={mode:!1,css:!1});var t=this.url()+"?md2html";return e.mode&&(t+=utils.format("/%s",e.mode)),e.css&&(t+=utils.format("/css/%s",utils.safeEncode(e.css))),t}}]),e}();window.FileAPI={staticPath:"http://iwillwen.u.qiniudn.com/",withCredentials:!1},function(e,t){function n(e,t,n,i,r){var a={type:n.type||n,target:e,result:i};N(a,r),t(a)}function i(e){return w&&!!w.prototype["readAs"+e]}function r(e,r,a,o){if(J.isFile(e)&&i(a)){var s=new w;$(s,D,function u(t){var i=t.type;"progress"==i?n(e,r,t,t.target.result,{loaded:t.loaded,total:t.total}):"loadend"==i?(X(s,D,u),s=null):n(e,r,t,t.target.result)});try{o?s["readAs"+a](e,o):s["readAs"+a](e)}catch(l){n(e,r,"error",t,{error:l.toString()})}}else n(e,r,"error",t,{error:"filreader_not_support_"+a})}function a(e,t){if(!e.type&&e.size%4096===0&&e.size<=102400)if(w)try{var n=new w;W(n,D,function(e){var i="error"!=e.type;t(i),i&&n.abort()}),n.readAsDataURL(e)}catch(i){t(!1)}else t(null);else t(!0)}function o(e){var t;return e.getAsEntry?t=e.getAsEntry():e.webkitGetAsEntry&&(t=e.webkitGetAsEntry()),t}function s(e,t){if(e)if(e.isFile)e.file(function(n){n.fullPath=e.fullPath,t(!1,[n])},function(e){t("FileError.code: "+e.code)});else if(e.isDirectory){var n=e.createReader(),i=[];n.readEntries(function(e){J.afor(e,function(e,n){s(n,function(n,r){n?J.log(n):i=i.concat(r),e?e():t(!1,i)})})},function(e){t("directory_reader: "+e)})}else s(o(e),t);else t("invalid entry")}function l(e){var t={};return M(e,function(e,n){e&&"object"===("undefined"==typeof e?"undefined":babelHelpers["typeof"](e))&&void 0===e.nodeType&&(e=N({},e)),t[n]=e}),t}function u(e){return R.test(e&&e.tagName)}function c(e){return(e.originalEvent||e||"").dataTransfer||{}}function f(e){var t;for(t in e)if(e.hasOwnProperty(t)&&!(e[t]instanceof Object||"overlay"===t||"filter"===t))return!0;return!1}var d=1,h=function(){},p=e.document,m=p.doctype||{},g=e.navigator.userAgent,v=e.createObjectURL&&e||e.URL&&URL.revokeObjectURL&&URL||e.webkitURL&&webkitURL,y=e.Blob,b=e.File,w=e.FileReader,x=e.FormData,k=e.XMLHttpRequest,A=e.jQuery,E=!(!(b&&w&&(e.Uint8Array||x||k.prototype.sendAsBinary))||/safari\//i.test(g)&&!/chrome\//i.test(g)&&/windows/i.test(g)),_=E&&"withCredentials"in new k,F=E&&!!y&&!!(y.prototype.webkitSlice||y.prototype.mozSlice||y.prototype.slice),I=e.dataURLtoBlob,j=/img/i,T=/canvas/i,C=/img|canvas/i,R=/input/i,L=/^data:[^,]+,/,U=e.Math,q=function(t){return t=new e.Number(U.pow(1024,t)),t.from=function(e){return U.round(e*this)},t},O={},P=[],D="abort progress error load loadend",S="status statusText readyState response responseXML responseText responseBody".split(" "),H="currentTarget",B="preventDefault",z=function(e){return e&&"length"in e},M=function(e,t,n){if(e)if(z(e))for(var i=0,r=e.length;r>i;i++)i in e&&t.call(n,e[i],i,e);else for(var a in e)e.hasOwnProperty(a)&&t.call(n,e[a],a,e)},N=function(e){for(var t=arguments,n=1,i=function(t,n){e[n]=t};n<t.length;n++)M(t[n],i);return e},$=function(e,t,n){if(e){var i=J.uid(e);O[i]||(O[i]={}),M(t.split(/\s+/),function(t){A?A.event.add(e,t,n):(O[i][t]||(O[i][t]=[]),O[i][t].push(n),e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n)})}},X=function(e,t,n){if(e){var i=J.uid(e),r=O[i]||{};M(t.split(/\s+/),function(t){if(A)A.event.remove(e,t,n);else{for(var i=r[t]||[],a=i.length;a--;)if(i[a]===n){i.splice(a,1);break}e.addEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=null}})}},W=function(e,t,n){$(e,t,function i(r){X(e,t,i),n(r)})},V=function(t){return t.target||(t.target=e.event&&e.event.srcElement||p),3===t.target.nodeType&&(t.target=t.target.parentNode),t},G=function(e){var t=p.createElement("input");return t.setAttribute("type","file"),e in t},J={version:"2.0.2",cors:!1,html5:!0,media:!1,formData:!0,debug:!1,pingUrl:!1,multiFlash:!1,flashAbortTimeout:0,withCredentials:!0,staticPath:"./dist/",flashUrl:0,flashImageUrl:0,postNameConcat:function(e,t){return e+(null!=t?"["+t+"]":"")},ext2mime:{jpg:"image/jpeg",tif:"image/tiff",txt:"text/plain"},accept:{"image/*":"art bm bmp dwg dxf cbr cbz fif fpx gif ico iefs jfif jpe jpeg jpg jps jut mcf nap nif pbm pcx pgm pict pm png pnm qif qtif ras rast rf rp svf tga tif tiff xbm xbm xpm xwd","audio/*":"m4a flac aac rm mpa wav wma ogg mp3 mp2 m3u mod amf dmf dsm far gdm imf it m15 med okt s3m stm sfx ult uni xm sid ac3 dts cue aif aiff wpl ape mac mpc mpp shn wv nsf spc gym adplug adx dsp adp ymf ast afc hps xs","video/*":"m4v 3gp nsv ts ty strm rm rmvb m3u ifo mov qt divx xvid bivx vob nrg img iso pva wmv asf asx ogm m2v avi bin dat dvr-ms mpg mpeg mp4 mkv avc vp3 svq3 nuv viv dv fli flv wpl"},chunkSize:0,chunkUploadRetry:0,chunkNetworkDownRetryTimeout:2e3,KB:q(1),MB:q(2),GB:q(3),TB:q(4),expando:"fileapi"+(new Date).getTime(),uid:function(e){return e?e[J.expando]=e[J.expando]||J.uid():(++d,J.expando+d)},log:function(){J.debug&&e.console&&console.log&&(console.log.apply?console.log.apply(console,arguments):console.log([].join.call(arguments," ")))},newImage:function(e,t){var n=p.createElement("img");return t&&J.event.one(n,"error load",function(e){t("error"==e.type,n),n=null}),n.src=e,n},getXHR:function(){var t;if(k)t=new k;else if(e.ActiveXObject)try{t=new ActiveXObject("MSXML2.XMLHttp.3.0")}catch(n){t=new ActiveXObject("Microsoft.XMLHTTP")}return t},isArray:z,support:{dnd:_&&"ondrop"in p.createElement("div"),cors:_,html5:E,chunked:F,dataURI:!0,accept:G("accept"),multiple:G("multiple")},event:{on:$,off:X,one:W,fix:V},throttle:function(t,n){var i,r;return function(){r=arguments,i||(t.apply(e,r),i=setTimeout(function(){i=0,t.apply(e,r)},n))}},F:function(){},parseJSON:function(t){var n;return n=e.JSON&&JSON.parse?JSON.parse(t):new Function("return ("+t.replace(/([\r\n])/g,"\\$1")+");")()},trim:function(e){return e=String(e),e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},defer:function K(){var e,n,i=[],K={resolve:function(t,r){for(K.resolve=h,n=t||!1,e=r;r=i.shift();)r(n,e)},then:function(r){n!==t?r(n,e):i.push(r)}};return K},queue:function Q(e){var t=0,n=0,i=!1,r=!1,Q={inc:function(){n++},next:function(){t++,setTimeout(Q.check,0)},check:function(){t>=n&&!i&&Q.end()},isFail:function(){return i},fail:function(){!i&&e(i=!0)},end:function(){r||(r=!0,e())}};return Q},each:M,afor:function(e,t){var n=0,i=e.length;z(e)&&i--?!function r(){t(i!=n&&r,e[n],n++)}():t(!1)},extend:N,isFile:function(e){return E&&e&&e instanceof b},isCanvas:function(e){return e&&T.test(e.nodeName)},getFilesFilter:function(e){return e="string"==typeof e?e:e.getAttribute&&e.getAttribute("accept")||"",e?new RegExp("("+e.replace(/\./g,"\\.").replace(/,/g,"|")+")$","i"):/./},readAsDataURL:function(e,t){J.isCanvas(e)?n(e,t,"load",J.toDataURL(e)):r(e,t,"DataURL")},readAsBinaryString:function(e,t){i("BinaryString")?r(e,t,"BinaryString"):r(e,function(e){if("load"==e.type)try{e.result=J.toBinaryString(e.result)}catch(n){e.type="error",e.message=n.toString()}t(e)},"DataURL")},readAsArrayBuffer:function(e,t){r(e,t,"ArrayBuffer")},readAsText:function(e,t,n){n||(n=t,t="utf-8"),r(e,n,"Text",t)},toDataURL:function(e,t){return"string"==typeof e?e:e.toDataURL?e.toDataURL(t||"image/png"):void 0},toBinaryString:function(t){return e.atob(J.toDataURL(t).replace(L,""))},readAsImage:function(e,i,r){if(J.isFile(e))if(v){var a=v.createObjectURL(e);a===t?n(e,i,"error"):J.readAsImage(a,i,r)}else J.readAsDataURL(e,function(t){"load"==t.type?J.readAsImage(t.result,i,r):(r||"error"==t.type)&&n(e,i,t,null,{loaded:t.loaded,total:t.total})});else if(J.isCanvas(e))n(e,i,"load",e);else if(j.test(e.nodeName))if(e.complete)n(e,i,"load",e);else{var o="error abort load";W(e,o,function l(t){"load"==t.type&&v&&v.revokeObjectURL(e.src),X(e,o,l),n(e,i,t,e)})}else if(e.iframe)n(e,i,{type:"error"});else{var s=J.newImage(e.dataURL||e);J.readAsImage(s,i,r)}},checkFileObj:function(e){var t={},n=J.accept;return"object"==("undefined"==typeof e?"undefined":babelHelpers["typeof"](e))?t=e:t.name=(e+"").split(/\\|\//g).pop(),null==t.type&&(t.type=t.name.split(".").pop()),M(n,function(e,n){e=new RegExp(e.replace(/\s/g,"|"),"i"),(e.test(t.type)||J.ext2mime[t.type])&&(t.type=J.ext2mime[t.type]||n.split("/")[0]+"/"+t.type)}),t},getDropFiles:function(e,t){var n=[],i=c(e),r=z(i.items)&&i.items[0]&&o(i.items[0]),l=J.queue(function(){t(n)});M((r?i.items:i.files)||[],function(e){l.inc();try{r?s(e,function(e,t){e?J.log("[err] getDropFiles:",e):n.push.apply(n,t),l.next()}):a(e,function(t){t&&n.push(e),l.next()})}catch(t){l.next(),J.log("[err] getDropFiles: ",t)}}),l.check()},getFiles:function(e,t,n){var i=[];return n?(J.filterFiles(J.getFiles(e),t,n),null):(e.jquery&&(e.each(function(){i=i.concat(J.getFiles(this))}),e=i,i=[]),"string"==typeof t&&(t=J.getFilesFilter(t)),e.originalEvent?e=V(e.originalEvent):e.srcElement&&(e=V(e)),e.dataTransfer?e=e.dataTransfer:e.target&&(e=e.target),e.files?(i=e.files,E||(i[0].blob=e,i[0].iframe=!0)):!E&&u(e)?J.trim(e.value)&&(i=[J.checkFileObj(e.value)],i[0].blob=e,i[0].iframe=!0):z(e)&&(i=e),J.filter(i,function(e){return!t||t.test(e.name)}))},getTotalSize:function(e){for(var t=0,n=e&&e.length;n--;)t+=e[n].size;return t},getInfo:function(e,t){var n={},i=P.concat();J.isFile(e)?!function r(){var a=i.shift();a?a.test(e.type)?a(e,function(e,i){e?t(e):(N(n,i),r())}):r():t(!1,n)}():t("not_support_info",n)},addInfoReader:function(e,t){t.test=function(t){return e.test(t)},P.push(t)},filter:function(e,t){for(var n,i=[],r=0,a=e.length;a>r;r++)r in e&&(n=e[r],t.call(n,n,r,e)&&i.push(n));return i},filterFiles:function(e,t,n){if(e.length){var i,r=e.concat(),a=[],o=[];!function s(){r.length?(i=r.shift(),J.getInfo(i,function(e,n){(t(i,e?!1:n)?a:o).push(i),s()})):n(a,o)}()}else n([],e)},upload:function(e){e=N({prepare:J.F,beforeupload:J.F,upload:J.F,fileupload:J.F,fileprogress:J.F,filecomplete:J.F,progress:J.F,complete:J.F,pause:J.F,imageOriginal:!0,chunkSize:J.chunkSize,chunkUpoloadRetry:J.chunkUploadRetry},e),e.imageAutoOrientation&&!e.imageTransform&&(e.imageTransform={rotate:"auto"});var t,n=new J.XHR(e),i=this._getFilesDataArray(e.files),r=this,a=0,o=0,s=!1;return M(i,function(e){a+=e.size}),n.files=[],M(i,function(e){n.files.push(e.file)}),n.total=a,n.loaded=0,n.filesLeft=i.length,e.beforeupload(n,e),t=function(){var u=i.shift(),c=u&&u.file,f=!1,d=l(e);n.filesLeft=i.length,c&&c.name===J.expando&&(c=null,J.log("[warn] FileAPI.upload() â€” called without files")),("abort"!=n.statusText||n.current)&&u?(s=!1,n.currentFile=c,c&&e.prepare(c,d),r._getFormData(d,u,function(s){o||e.upload(n,e);var l=new J.XHR(N({},d,{upload:c?function(){e.fileupload(c,l,d)}:h,progress:c?function(t){f||(e.fileprogress({type:"progress",total:u.total=t.total,loaded:u.loaded=t.loaded},c,l,d),e.progress({type:"progress",total:a,loaded:n.loaded=o+u.size*(t.loaded/t.total)|0},c,l,d))}:h,complete:function(i){f=!0,M(S,function(e){n[e]=l[e]}),c&&(u.loaded=u.total,this.progress(u),o+=u.size,n.loaded=o,e.filecomplete(i,l,c,d)),t.call(r)}}));n.abort=function(e){e||(i.length=0),this.current=e,l.abort()},l.send(s)})):(e.complete(200==n.status||201==n.status?!1:n.statusText||"error",n,e),s=!0)},setTimeout(t,0),n.append=function(e,o){e=J._getFilesDataArray([].concat(e)),M(e,function(e){a+=e.size,n.files.push(e.file),o?i.unshift(e):i.push(e)}),n.statusText="",s&&t.call(r)},n.remove=function(e){for(var t,n=i.length;n--;)i[n].file==e&&(t=i.splice(n,1),a-=t.size);return t},n},_getFilesDataArray:function(e){var t=[],n={};if(u(e)){var i=J.getFiles(e);n[e.name||"file"]=null!==e.getAttribute("multiple")?i:i[0]}else z(e)&&u(e[0])?M(e,function(e){n[e.name||"file"]=J.getFiles(e)}):n=e;return M(n,function r(e,n){z(e)?M(e,function(e){r(e,n)}):e&&(e.name||e.image)&&t.push({name:n,file:e,size:e.size,total:e.size,loaded:0})}),t.length||t.push({file:{name:J.expando}}),t},_getFormData:function(e,t,n){var i=t.file,r=t.name,a=i.name,o=i.type,s=J.support.transform&&e.imageTransform,l=new J.Form,u=J.queue(function(){n(l)}),c=s&&f(s),d=J.postNameConcat;!function h(t){t.image?(u.inc(),t.toData(function(e,t){a=a||(new Date).getTime()+".png",h(t),u.next()})):J.Image&&s&&(/^image/.test(t.type)||C.test(t.nodeName))?(u.inc(),c&&(s=[s]),J.Image.transform(t,s,e.imageAutoOrientation,function(n,i){if(c&&!n)I||J.flashEngine||(l.multipart=!0),l.append(r,i[0],a,s[0].type||o);else{var f=0;n||M(i,function(e,t){I||J.flashEngine||(l.multipart=!0),s[t].postName||(f=1),l.append(s[t].postName||d(r,t),e,a,s[t].type||o)}),(n||e.imageOriginal)&&l.append(d(r,f?"original":null),t,a,o)}u.next()})):a!==J.expando&&l.append(r,t,a)}(i),M(e.data,function p(e,t){"object"==("undefined"==typeof e?"undefined":babelHelpers["typeof"](e))?M(e,function(e,n){p(e,d(t,n))}):l.append(t,e)}),u.check()},reset:function(e,t){var n,i;return A?(i=A(e).clone(!0).insertBefore(e).val("")[0],t||A(e).remove()):(n=e.parentNode,i=n.insertBefore(e.cloneNode(!0),e),i.value="",t||n.removeChild(e),M(O[J.uid(e)],function(t,n){M(t,function(t){X(e,n,t),$(i,n,t)})})),i},load:function(e,t){var n=J.getXHR();return n?(n.open("GET",e,!0),n.overrideMimeType&&n.overrideMimeType("text/plain; charset=x-user-defined"),$(n,"progress",function(e){e.lengthComputable&&t({type:e.type,loaded:e.loaded,total:e.total},n)}),n.onreadystatechange=function(){if(4==n.readyState)if(n.onreadystatechange=null,200==n.status){e=e.split("/");var i={name:e[e.length-1],size:n.getResponseHeader("Content-Length"),type:n.getResponseHeader("Content-Type")};i.dataURL="data:"+i.type+";base64,"+J.encode64(n.responseBody||n.responseText),t({type:"load",result:i},n)}else t({type:"error"},n)},n.send(null)):t({type:"error"}),n},encode64:function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="",i=0;for("string"!=typeof e&&(e=String(e));i<e.length;){var r,a,o=255&e.charCodeAt(i++),s=255&e.charCodeAt(i++),l=255&e.charCodeAt(i++),u=o>>2,c=(3&o)<<4|s>>4;isNaN(s)?r=a=64:(r=(15&s)<<2|l>>6,a=isNaN(l)?64:63&l),n+=t.charAt(u)+t.charAt(c)+t.charAt(r)+t.charAt(a)}return n}};J.addInfoReader(/^image/,function(e,t){if(!e.__dimensions){var n=e.__dimensions=J.defer();J.readAsImage(e,function(e){var t=e.target;n.resolve("load"==e.type?!1:"error",{width:t.width,height:t.height}),t=null})}e.__dimensions.then(t)}),J.event.dnd=function(e,t,n){var i,r;n||(n=t,t=J.F),w?($(e,"dragenter dragleave dragover",function(e){for(var n=c(e).types,a=n&&n.length,o=!1;a--;)if(~n[a].indexOf("File")){e[B](),r!==e.type&&(r=e.type,"dragleave"!=r&&t.call(e[H],!0,e),o=!0);break}o&&(clearTimeout(i),i=setTimeout(function(){t.call(e[H],"dragleave"!=r,e)},50))}),$(e,"drop",function(e){e[B](),r=0,t.call(e[H],!1,e),J.getDropFiles(e,function(t){n.call(e[H],t,e)})})):J.log("Drag'n'Drop -- not supported")},J.event.dnd.off=function(e,t,n){X(e,"dragenter dragleave dragover",t),X(e,"drop",n)},A&&!A.fn.dnd&&(A.fn.dnd=function(e,t){return this.each(function(){J.event.dnd(this,e,t)})},A.fn.offdnd=function(e,t){return this.each(function(){J.event.dnd.off(this,e,t)})}),e.FileAPI=N(J,e.FileAPI),J.log("FileAPI: "+J.version),J.log("protocol: "+e.location.protocol),J.log("doctype: ["+m.name+"] "+m.publicId+" "+m.systemId),M(p.getElementsByTagName("meta"),function(e){/x-ua-compatible/i.test(e.getAttribute("http-equiv"))&&J.log("meta.http-equiv: "+e.getAttribute("content"))}),J.flashUrl||(J.flashUrl=J.staticPath+"FileAPI.flash.swf"),J.flashImageUrl||(J.flashImageUrl=J.staticPath+"FileAPI.flash.image.swf"),J.flashWebcamUrl||(J.flashWebcamUrl=J.staticPath+"FileAPI.flash.camera.swf")}(window,void 0),function(e,t,n){function i(t){if(t instanceof i){var n=new i(t.file);return e.extend(n.matrix,t.matrix),n}return this instanceof i?(this.file=t,void(this.matrix={sx:0,sy:0,sw:0,sh:0,dx:0,dy:0,dw:0,dh:0,resize:0,deg:0,quality:1,filter:0})):new i(t)}var r=Math.min,a=Math.round,o=function(){return t.createElement("canvas")},s=!1,l={8:270,3:180,6:90};try{s=o().toDataURL("image/png").indexOf("data:image/png")>-1}catch(u){}i.prototype={image:!0,constructor:i,set:function(t){return e.extend(this.matrix,t),this},crop:function(e,t,i,r){return i===n&&(i=e,r=t,e=t=0),this.set({sx:e,sy:t,sw:i,sh:r||i})},resize:function(e,t,n){return"string"==typeof t&&(n=t,t=e),this.set({dw:e,dh:t,resize:n})},preview:function(e,t){return this.resize(e,t||e,"preview")},rotate:function(e){return this.set({deg:e})},filter:function(e){return this.set({filter:e})},overlay:function(e){return this.set({overlay:e})},clone:function(){return new i(this)},_load:function(t,n){var i=this;/img|video/i.test(t.nodeName)?n.call(i,null,t):e.readAsImage(t,function(e){n.call(i,"load"!=e.type,e.result)})},_apply:function(t,n){var a,s=o(),l=this.getMatrix(t),u=s.getContext("2d"),c=t.videoWidth||t.width,f=t.videoHeight||t.height,d=l.deg,h=l.dw,p=l.dh,m=c,g=f,v=l.filter,y=t,b=l.overlay,w=e.queue(function(){n(!1,s)}),x=e.renderImageToCanvas;for(t._type=this.file.type;r(m/h,g/p)>2;)m=m/2+.5|0,g=g/2+.5|0,a=o(),a.width=m,a.height=g,y!==t?(x(a,y,0,0,y.width,y.height,0,0,m,g),y=a):(y=a,x(y,t,l.sx,l.sy,l.sw,l.sh,0,0,m,g),l.sx=l.sy=l.sw=l.sh=0);s.width=d%180?p:h,s.height=d%180?h:p,s.type=l.type,s.quality=l.quality,u.rotate(d*Math.PI/180),x(s,y,l.sx,l.sy,l.sw||y.width,l.sh||y.height,180==d||270==d?-h:0,90==d||180==d?-p:0,h,p),h=s.width,p=s.height,b&&e.each([].concat(b),function(t){w.inc();var n=new window.Image,i=function r(){var i=0|t.x,a=0|t.y,o=t.w||n.width,s=t.h||n.height,l=t.rel;i=1==l||4==l||7==l?(h-o+i)/2:2==l||5==l||8==l?h-(o+i):i,a=3==l||4==l||5==l?(p-s+a)/2:l>=6?p-(s+a):a,e.event.off(n,"error load abort",r);try{u.globalAlpha=t.opacity||1,u.drawImage(n,i,a,o,s)}catch(c){}w.next()};e.event.on(n,"error load abort",i),n.src=t.src,n.complete&&i()}),v&&(w.inc(),i.applyFilter(s,v,w.next)),w.check()},getMatrix:function(t){var n=e.extend({},this.matrix),i=n.sw=n.sw||t.videoWidth||t.naturalWidth||t.width,o=n.sh=n.sh||t.videoHeight||t.naturalHeight||t.height,s=n.dw=n.dw||i,l=n.dh=n.dh||o,u=i/o,c=s/l,f=n.resize;if("preview"==f){if(s!=i||l!=o){var d,h;c>=u?(d=i,h=d/c):(h=o,d=h*c),d==i&&h==o||(n.sx=~~((i-d)/2),n.sy=~~((o-h)/2),i=d,o=h)}}else f&&(i>s||o>l?"min"==f?(s=a(c>u?r(i,s):l*u),l=a(c>u?s/u:r(o,l))):(s=a(u>=c?r(i,s):l*u),l=a(u>=c?s/u:r(o,l))):(s=i,l=o));return n.sw=i,n.sh=o,n.dw=s,n.dh=l,n},_trans:function(e){this._load(this.file,function(t,n){t?e(t):this._apply(n,e)})},get:function(t){if(e.support.transform){var n=this,i=n.matrix;"auto"==i.deg?e.getInfo(n.file,function(e,r){i.deg=l[r&&r.exif&&r.exif.Orientation]||0,n._trans(t)}):n._trans(t)}else t("not_support_transform")},toData:function(e){this.get(e)}},i.exifOrientation=l,i.transform=function(t,r,a,o){function s(s,l){var u={},c=e.queue(function(e){o(e,u)});s?c.fail():e.each(r,function(e,r){if(!c.isFail()){var o=new i(l.nodeType?l:t);if("function"==typeof e?e(l,o):e.width?o[e.preview?"preview":"resize"](e.width,e.height,e.type):e.maxWidth&&(l.width>e.maxWidth||l.height>e.maxHeight)&&o.resize(e.maxWidth,e.maxHeight,"max"),e.crop){var s=e.crop;o.crop(0|s.x,0|s.y,s.w||s.width,s.h||s.height)}e.rotate===n&&a&&(e.rotate="auto"),o.set({deg:e.rotate,type:e.type||t.type||"image/png",quality:e.quality||1,overlay:e.overlay,filter:e.filter}),c.inc(),o.toData(function(e,t){e?c.fail():(u[r]=t,c.next())})}})}t.width?s(!1,t):e.getInfo(t,s)},e.each(["TOP","CENTER","BOTTOM"],function(t,n){e.each(["LEFT","CENTER","RIGHT"],function(e,r){i[t+"_"+e]=3*n+r,i[e+"_"+t]=3*n+r})}),i.toCanvas=function(e){var n=t.createElement("canvas");return n.width=e.videoWidth||e.width,n.height=e.videoHeight||e.height,n.getContext("2d").drawImage(e,0,0),n},i.fromDataURL=function(t,n,i){var r=e.newImage(t);e.extend(r,n),i(r)},i.applyFilter=function(t,n,r){"function"==typeof n?n(t,r):window.Caman&&window.Caman("IMG"==t.tagName?i.toCanvas(t):t,function(){"string"==typeof n?this[n]():e.each(n,function(e,t){this[t](e)},this),this.render(r)})},e.renderImageToCanvas=function(e,t,n,i,r,a,o,s,l,u){return e.getContext("2d").drawImage(t,n,i,r,a,o,s,l,u),e},e.support.canvas=e.support.transform=s,e.Image=i}(FileAPI,document),function(e,t){function n(t,n,i){var r=t.blob,a=t.file;if(a){if(!r.toDataURL)return void e.readAsBinaryString(r,function(e){"load"==e.type&&n(t,e.result)});var o={"image/jpeg":".jpe?g","image/png":".png"},s=o[t.type]?t.type:"image/png",l=o[s]||".png",u=r.quality||1;a.match(new RegExp(l+"$","i"))||(a+=l.replace("?","")),t.file=a,t.type=s,!i&&r.toBlob?r.toBlob(function(e){n(t,e)},s,u):n(t,e.toBinaryString(r.toDataURL(s,u)))}else n(t,r)}var i=t.document,r=t.FormData,a=function(){this.items=[]},o=t.encodeURIComponent;a.prototype={append:function(e,t,n,i){this.items.push({name:e,blob:t&&t.blob||(void 0==t?"":t),file:t&&(n||t.name),type:t&&(i||t.type)})},each:function(e){for(var t=0,n=this.items.length;n>t;t++)e.call(this,this.items[t])},toData:function(t,n){n._chunked=e.support.chunked&&n.chunkSize>0&&1==e.filter(this.items,function(e){return e.file}).length,e.support.html5?e.formData&&!this.multipart&&r?n._chunked?(e.log("FileAPI.Form.toPlainData"),this.toPlainData(t)):(e.log("FileAPI.Form.toFormData"),this.toFormData(t)):(e.log("FileAPI.Form.toMultipartData"),this.toMultipartData(t)):(e.log("FileAPI.Form.toHtmlData"),this.toHtmlData(t))},_to:function(t,n,i,r){var a=e.queue(function(){n(t)});this.each(function(e){i(e,t,a,r)}),a.check()},toHtmlData:function(t){this._to(i.createDocumentFragment(),t,function(t,n){var r,a=t.blob;t.file?(e.reset(a,!0),a.name=t.name,n.appendChild(a)):(r=i.createElement("input"),r.name=t.name,r.type="hidden",r.value=a,n.appendChild(r))})},toPlainData:function(e){this._to({},e,function(e,t,i){e.file&&(t.type=e.file),e.blob.toBlob?(i.inc(),n(e,function(e,n){t.name=e.name,t.file=n,t.size=n.length,t.type=e.type,i.next()})):e.file?(t.name=e.blob.name,t.file=e.blob,t.size=e.blob.size,t.type=e.type):(t.params||(t.params=[]),t.params.push(o(e.name)+"="+o(e.blob))),t.start=-1,t.end=t.file&&t.file.FileAPIReadPosition||-1,t.retry=0})},toFormData:function(e){this._to(new r,e,function(e,t,i){e.blob&&e.blob.toBlob?(i.inc(),n(e,function(e,n){t.append(e.name,n,e.file),i.next()})):e.file?t.append(e.name,e.blob,e.file):t.append(e.name,e.blob),e.file&&t.append("_"+e.name,e.file)})},toMultipartData:function(t){this._to([],t,function(e,t,i,r){i.inc(),n(e,function(e,n){t.push("--_"+r+('\r\nContent-Disposition: form-data; name="'+e.name+'"'+(e.file?'; filename="'+o(e.file)+'"':"")+(e.file?"\r\nContent-Type: "+(e.type||"application/octet-stream"):"")+"\r\n\r\n"+(e.file?n:o(n))+"\r\n")),i.next()},!0)},e.expando)}},e.Form=a}(FileAPI,window),function(e,t){var n=function(){},i=e.document,r=function(e){this.uid=t.uid(),this.xhr={abort:n,getResponseHeader:n,getAllResponseHeaders:n},this.options=e},a={"":1,XML:1,Text:1,Body:1};r.prototype={status:0,statusText:"",constructor:r,getResponseHeader:function(e){return this.xhr.getResponseHeader(e)},getAllResponseHeaders:function(){return this.xhr.getAllResponseHeaders()||{}},end:function(i,r){var a=this,o=a.options;a.end=a.abort=n,a.status=i,r&&(a.statusText=r),t.log("xhr.end:",i,r),o.complete(200==i||201==i?!1:a.statusText||"unknown",a),a.xhr&&a.xhr.node&&setTimeout(function(){var t=a.xhr.node;try{t.parentNode.removeChild(t)}catch(n){}try{delete e[a.uid]}catch(n){}e[a.uid]=a.xhr.node=null},9)},abort:function(){this.end(0,"abort"),this.xhr&&(this.xhr.aborted=!0,this.xhr.abort())},send:function(e){var t=this,n=this.options;e.toData(function(e){n.upload(n,t),t._send.call(t,n,e)},n)},_send:function(n,r){var o,s=this,l=s.uid,u=n.url;if(t.log("XHR._send:",r),n.cache||(u+=(~u.indexOf("?")?"&":"?")+t.uid()),r.nodeName){n.upload(n,s),o=i.createElement("div"),o.innerHTML='<form target="'+l+'" action="'+u+'" method="POST" enctype="multipart/form-data" style="position: absolute; top: -1000px; overflow: hidden; width: 1px; height: 1px;"><iframe name="'+l+'" src="javascript:false;"></iframe><input value="'+l+'" name="callback" type="hidden"/></form>',s.xhr.abort=function(){var e=o.getElementsByTagName("iframe")[0];if(e)try{e.stop?e.stop():e.contentWindow.stop?e.contentWindow.stop():e.contentWindow.document.execCommand("Stop")}catch(t){}o=null};var c=o.getElementsByTagName("form")[0];c.appendChild(r),t.log(c.parentNode.innerHTML),i.body.appendChild(o),s.xhr.node=o,e[l]=function(e,t,n){s.readyState=4,s.responseText=n,s.end(e,t),o=null},s.readyState=2,c.submit(),c=null}else{if(this.xhr&&this.xhr.aborted)return void t.log("Error: already aborted");if(o=s.xhr=t.getXHR(),r.params&&(u+=(u.indexOf("?")<0?"?":"&")+r.params.join("&")),o.open("POST",u,!0),t.withCredentials&&(o.withCredentials="true"),n.headers&&n.headers["X-Requested-With"]||o.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.each(n.headers,function(e,t){o.setRequestHeader(t,e)}),n._chunked){o.upload&&o.upload.addEventListener("progress",function(e){r.retry||n.progress({type:e.type,total:r.size,loaded:r.start+e.loaded,totalSize:r.size},s,n)},!1),o.onreadystatechange=function(){var e=parseInt(o.getResponseHeader("X-Last-Known-Byte"),10);if(s.status=o.status,s.statusText=o.statusText,s.readyState=o.readyState,4==o.readyState){for(var i in a)s["response"+i]=o["response"+i];if(o.onreadystatechange=null,!o.status||o.status-201>0)if(t.log("Error: "+o.status),(!o.status&&!o.aborted||500==o.status||416==o.status)&&++r.retry<=n.chunkUploadRetry){var l=o.status?0:t.chunkNetworkDownRetryTimeout;n.pause(r.file,n),t.log("X-Last-Known-Byte: "+e),e?r.end=e:r.end=r.start-1,setTimeout(function(){s._send(n,r)},l)}else s.end(o.status);else r.retry=0,
r.end==r.size-1?s.end(o.status):(t.log("X-Last-Known-Byte: "+e),e&&(r.end=e),r.file.FileAPIReadPosition=r.end,setTimeout(function(){s._send(n,r)},0));o=null}},r.start=r.end+1,r.end=Math.max(Math.min(r.start+n.chunkSize,r.size)-1,r.start);var f;(f="slice")in r.file||(f="mozSlice")in r.file||(f="webkitSlice")in r.file,o.setRequestHeader("Content-Range","bytes "+r.start+"-"+r.end+"/"+r.size),o.setRequestHeader("Content-Disposition","attachment; filename="+encodeURIComponent(r.name)),o.setRequestHeader("Content-Type",r.type||"application/octet-stream"),f=r.file[f](r.start,r.end+1),o.send(f),f=null}else if(o.upload&&o.upload.addEventListener("progress",t.throttle(function(e){n.progress(e,s,n)},100),!1),o.onreadystatechange=function(){if(s.status=o.status,s.statusText=o.statusText,s.readyState=o.readyState,4==o.readyState){for(var e in a)s["response"+e]=o["response"+e];o.onreadystatechange=null,s.end(o.status),o=null}},t.isArray(r))if(o.setRequestHeader("Content-Type","multipart/form-data; boundary=_"+t.expando),r=r.join("")+"--_"+t.expando+"--",o.sendAsBinary)o.sendAsBinary(r);else{var d=Array.prototype.map.call(r,function(e){return 255&e.charCodeAt(0)});o.send(new Uint8Array(d).buffer)}else o.send(r)}}},t.XHR=r}(window,FileAPI),function(e,t){function n(e){return e>=0?e+"px":e}function i(e){var t,n=a.createElement("canvas"),i=!1;try{t=n.getContext("2d"),t.drawImage(e,0,0,1,1),i=255!=t.getImageData(0,0,1,1).data[4]}catch(r){}return i}var r=e.URL||e.webkitURL,a=e.document,o=e.navigator,s=o.getUserMedia||o.webkitGetUserMedia||o.mozGetUserMedia||o.msGetUserMedia,l=!!s;t.support.media=l;var u=function(e){this.video=e};u.prototype={isActive:function(){return!!this._active},start:function(e){var t,n,a=this,l=a.video,u=function(i){a._active=!i,clearTimeout(n),clearTimeout(t),e&&e(i,a)};s.call(o,{video:!0},function(e){a.stream=e,l.src=r.createObjectURL(e),t=setInterval(function(){i(l)&&u(null)},1e3),n=setTimeout(function(){u("timeout")},5e3),l.play()},u)},stop:function(){try{this._active=!1,this.video.pause(),this.stream.stop()}catch(e){}},shot:function(){return new c(this.video)}},u.get=function(e){return new u(e.firstChild)},u.publish=function(i,r,o){"function"==typeof r&&(o=r,r={}),r=t.extend({},{width:"100%",height:"100%",start:!0},r),i.jquery&&(i=i[0]);var s=function(e){if(e)o(e);else{var t=u.get(i);r.start?t.start(o):o(null,t)}};if(i.style.width=n(r.width),i.style.height=n(r.height),t.html5&&l){var c=a.createElement("video");c.style.width=n(r.width),c.style.height=n(r.height),e.jQuery?jQuery(i).empty():i.innerHTML="",i.appendChild(c),s()}else u.fallback(i,r,s)},u.fallback=function(e,t,n){n("not_support_camera")};var c=function(e){var n=e.nodeName?t.Image.toCanvas(e):e,i=t.Image(n);return i.type="image/png",i.width=n.width,i.height=n.height,i.size=n.width*n.height*4,i};u.Shot=c,t.Camera=u}(window,FileAPI),function(e,t,n){var i=e.document,r=e.location,a=e.navigator,o=n.each,s=[];n.support.flash=function(){var t=a.mimeTypes,i=!1;if(a.plugins&&"object"==babelHelpers["typeof"](a.plugins["Shockwave Flash"]))i=a.plugins["Shockwave Flash"].description&&!(t&&t["application/x-shockwave-flash"]&&!t["application/x-shockwave-flash"].enabledPlugin);else try{i=!(!e.ActiveXObject||!new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))}catch(o){n.log("Flash -- does not supported.")}return i&&/^file:/i.test(r)&&n.log("[warn] Flash does not work on `file:` protocol."),i}(),n.support.flash&&(!n.html5||!n.support.html5||n.cors&&!n.support.cors||n.media&&!n.support.media)&&function(){function l(e){return('<object id="#id#" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+(e.width||"100%")+'" height="'+(e.height||"100%")+'"><param name="movie" value="#src#" /><param name="flashvars" value="#flashvars#" /><param name="swliveconnect" value="true" /><param name="allowscriptaccess" value="always" /><param name="allownetworking" value="all" /><param name="menu" value="false" /><param name="wmode" value="#wmode#" /><embed flashvars="#flashvars#" swliveconnect="true" allownetworking="all" allowscriptaccess="always" name="#id#" src="#src#" width="'+(e.width||"100%")+'" height="'+(e.height||"100%")+'" menu="false" wmode="transparent" type="application/x-shockwave-flash"></embed></object>').replace(/#(\w+)#/gi,function(t,n){return e[n]})}function u(e,t){if(e&&e.style){var n,i;for(n in t){i=t[n],"number"==typeof i&&(i+="px");try{e.style[n]=i}catch(r){}}}}function c(e,t){o(t,function(t,n){var i=e[n];e[n]=function(){return this.parent=i,t.apply(this,arguments)}})}function f(e){return e&&!e.flashId}function d(e){var t=e.wid=n.uid();return k._fn[t]=e,"FileAPI.Flash._fn."+t}function h(e){try{k._fn[e.wid]=null,delete k._fn[e.wid]}catch(t){}}function p(e,t){if(!x.test(e)){if(/^\.\//.test(e)||"/"!=e.charAt(0)){var n=r.pathname;n=n.substr(0,n.lastIndexOf("/")),e=(n+"/"+e).replace("/./","/")}"//"!=e.substr(0,2)&&(e="//"+r.host+e),x.test(e)||(e=r.protocol+e)}return t&&(e+=(/\?/.test(e)?"&":"?")+t),e}function m(e,t,r){function a(){try{var e=k.get(s);e.setImage(t)}catch(i){n.log('[err] FlashAPI.Preview.setImage -- can not set "base64":',i)}}var o,s=n.uid(),c=i.createElement("div"),f=10;for(o in e)c.setAttribute(o,e[o]),c[o]=e[o];u(c,e),e.width="100%",e.height="100%",c.innerHTML=l(n.extend({id:s,src:p(n.flashImageUrl,"r="+n.uid()),wmode:"opaque",flashvars:"scale="+e.scale+"&callback="+d(function m(){return h(m),--f>0&&a(),!0})},e)),r(!1,c),c=null}function g(e){return{id:e.id,name:e.name,matrix:e.matrix,flashId:e.flashId}}function v(t){var n=t.getBoundingClientRect(),r=i.body,a=(t&&t.ownerDocument).documentElement;return{top:n.top+(e.pageYOffset||a.scrollTop)-(a.clientTop||r.clientTop||0),left:n.left+(e.pageXOffset||a.scrollLeft)-(a.clientLeft||r.clientLeft||0),width:n.right-n.left,height:n.bottom-n.top}}var y=n.uid(),b=0,w={},x=/^https?:/i,k={_fn:{},init:function(){var e=i.body&&i.body.firstChild;if(e)do if(1==e.nodeType){n.log("FlashAPI.state: awaiting");var t=i.createElement("div");return t.id="_"+y,u(t,{top:1,right:1,width:5,height:5,position:"absolute",zIndex:1e6+""}),e.parentNode.insertBefore(t,e),void k.publish(t,y)}while(e=e.nextSibling);10>b&&setTimeout(k.init,50*++b)},publish:function(e,t,i){i=i||{},e.innerHTML=l({id:t,src:p(n.flashUrl,"r="+n.version),wmode:i.camera?"":"transparent",flashvars:"callback="+(i.onEvent||"FileAPI.Flash.onEvent")+"&flashId="+t+"&storeKey="+a.userAgent.match(/\d/gi).join("")+"_"+n.version+(k.isReady||(n.pingUrl?"&ping="+n.pingUrl:""))+"&timeout="+n.flashAbortTimeout+(i.camera?"&useCamera="+p(n.flashWebcamUrl):"")},i)},ready:function(){n.log("FlashAPI.state: ready"),k.ready=n.F,k.isReady=!0,k.patch(),n.event.on(i,"mouseover",k.mouseover),n.event.on(i,"click",function(e){k.mouseover(e)&&(e.preventDefault?e.preventDefault():e.returnValue=!0)})},getEl:function(){return i.getElementById("_"+y)},getWrapper:function(e){do if(/js-fileapi-wrapper/.test(e.className))return e;while((e=e.parentNode)&&e!==i.body)},mouseover:function(e){var t=n.event.fix(e).target;if(/input/i.test(t.nodeName)&&"file"==t.type){var r=t.getAttribute(y),a=k.getWrapper(t);if(n.multiFlash){if("i"==r||"r"==r)return!1;if("p"!=r){t.setAttribute(y,"i");var o=i.createElement("div");if(!a)return void n.log("[err] FlashAPI.mouseover: js-fileapi-wrapper not found");u(o,{top:0,left:0,width:t.offsetWidth+100,height:t.offsetHeight+100,zIndex:1e6+"",position:"absolute"}),a.appendChild(o),k.publish(o,n.uid()),t.setAttribute(y,"p")}return!0}if(a){var s=v(a);u(k.getEl(),s),k.curInp=t}}else/object|embed/i.test(t.nodeName)||u(k.getEl(),{top:1,left:1,width:5,height:5})},onEvent:function(e){var t=e.type;if("ready"==t){try{k.getInput(e.flashId).setAttribute(y,"r")}catch(i){}return k.ready(),setTimeout(function(){k.mouseenter(e)},50),!0}"ping"===t?n.log("(flash -> js).ping:",[e.status,e.savedStatus],e.error):"log"===t?n.log("(flash -> js).log:",e.target):t in k&&setTimeout(function(){n.log("FlashAPI.event."+e.type+":",e),k[t](e)},1)},mouseenter:function(e){var t=k.getInput(e.flashId);if(t){k.cmd(e,"multiple",null!=t.getAttribute("multiple"));var i=[],r={};o((t.getAttribute("accept")||"").split(/,\s*/),function(e){n.accept[e]&&o(n.accept[e].split(" "),function(e){r[e]=1})}),o(r,function(e,t){i.push(t)}),k.cmd(e,"accept",i.length?i.join(",")+","+i.join(",").toUpperCase():"*")}},get:function(t){return i[t]||e[t]||i.embeds[t]},getInput:function(e){if(!n.multiFlash)return k.curInp;try{var t=k.getWrapper(k.get(e));if(t)return t.getElementsByTagName("input")[0]}catch(i){n.log('[err] Can not find "input" by flashId:',e,i)}},select:function(e){var r,a=k.getInput(e.flashId),s=n.uid(a),l=e.target.files;o(l,function(e){n.checkFileObj(e)}),w[s]=l,i.createEvent?(r=i.createEvent("Event"),r.files=l,r.initEvent("change",!0,!0),a.dispatchEvent(r)):t?t(a).trigger({type:"change",files:l}):(r=i.createEventObject(),r.files=l,a.fireEvent("onchange",r))},cmd:function(e,t,i,r){try{return n.log("(js -> flash)."+t+":",i),k.get(e.flashId||e).cmd(t,i)}catch(a){n.log("(js -> flash).onError:",a),r||setTimeout(function(){k.cmd(e,t,i,!0)},50)}},patch:function(){n.flashEngine=n.support.transform=!0,c(n,{getFiles:function(e,t,i){if(i)return n.filterFiles(n.getFiles(e),t,i),null;var r=n.isArray(e)?e:w[n.uid(e.target||e.srcElement||e)];return r?(t&&(t=n.getFilesFilter(t),r=n.filter(r,function(e){return t.test(e.name)})),r):this.parent.apply(this,arguments)},getInfo:function(e,t){if(f(e))this.parent.apply(this,arguments);else if(e.isShot)t(null,e.info={width:e.width,height:e.height});else{if(!e.__info){var i=e.__info=n.defer();k.cmd(e,"getFileInfo",{id:e.id,callback:d(function r(t,n){h(r),i.resolve(t,e.info=n)})})}e.__info.then(t)}}}),n.support.transform=!0,n.Image&&c(n.Image.prototype,{get:function(e,t){this.set({scaleMode:t||"noScale"}),this.parent(e)},_load:function(e,t){if(n.log("FlashAPI.Image._load:",e),f(e))this.parent.apply(this,arguments);else{var i=this;n.getInfo(e,function(n){t.call(i,n,e)})}},_apply:function(e,t){if(n.log("FlashAPI.Image._apply:",e),f(e))this.parent.apply(this,arguments);else{var i=this.getMatrix(e.info),r=t;k.cmd(e,"imageTransform",{id:e.id,matrix:i,callback:d(function a(o,s){n.log("FlashAPI.Image._apply.callback:",o),h(a),o?r(o):n.support.html5||n.support.dataURI&&!(s.length>3e4)?(i.filter&&(r=function(e,r){e?t(e):n.Image.applyFilter(r,i.filter,function(){t(e,this.canvas)})}),n.newImage("data:"+e.type+";base64,"+s,r)):m({width:i.deg%180?i.dh:i.dw,height:i.deg%180?i.dw:i.dh,scale:i.scaleMode},s,r)})})}},toData:function(e){var t=this.file,i=t.info,r=this.getMatrix(i);f(t)?this.parent.apply(this,arguments):("auto"==r.deg&&(r.deg=n.Image.exifOrientation[i&&i.exif&&i.exif.Orientation]||0),e.call(this,!t.info,{id:t.id,flashId:t.flashId,name:t.name,type:t.type,matrix:r}))}}),n.Image&&c(n.Image,{fromDataURL:function(e,t,i){!n.support.dataURI||e.length>3e4?m(n.extend({scale:"exactFit"},t),e.replace(/^data:[^,]+,/,""),function(e,t){i(t)}):this.parent(e,t,i)}}),n.Camera.fallback=function(e,t,i){var r=n.uid();n.log("FlashAPI.Camera.publish: "+r),k.publish(e,r,n.extend(t,{camera:!0,onEvent:d(function a(e){"camera"==e.type&&(h(a),e.error?(n.log("FlashAPI.Camera.publish.error: "+e.error),i(e.error)):(n.log("FlashAPI.Camera.publish.success: "+r),i(null)))})}))},o(s,function(e){n.Camera.fallback.apply(n.Camera,e)}),s=[],c(n.Camera.prototype,{_id:function(){return this.video.id},start:function(e){var t=this;k.cmd(this._id(),"camera.on",{callback:d(function i(r){h(i),r.error?(n.log("FlashAPI.camera.on.error: "+r.error),e(r.error,t)):(n.log("FlashAPI.camera.on.success: "+t._id()),t._active=!0,e(null,t))})})},stop:function(){this._active=!1,k.cmd(this._id(),"camera.off")},shot:function e(){n.log("FlashAPI.Camera.shot:",this._id());var e=k.cmd(this._id(),"shot",{});return e.type="image/png",e.flashId=this._id(),e.isShot=!0,new n.Camera.Shot(e)}}),c(n.Form.prototype,{toData:function(e){for(var t=this.items,i=t.length;i--;)if(t[i].file&&f(t[i].blob))return this.parent.apply(this,arguments);n.log("FlashAPI.Form.toData"),e(t)}}),c(n.XHR.prototype,{_send:function(e,t){if(t.nodeName||t.append&&n.support.html5||n.isArray(t)&&"string"==typeof t[0])return this.parent.apply(this,arguments);var i,r,a={},s={},l=this;if(o(t,function(e){e.file?(s[e.name]=e=g(e.blob),r=e.id,i=e.flashId):a[e.name]=e.blob}),r||(i=y),!i)return n.log("[err] FlashAPI._send: flashId -- undefined"),this.parent.apply(this,arguments);n.log("FlashAPI.XHR._send: "+i+" -> "+r,s),l.xhr={headers:{},abort:function(){k.cmd(i,"abort",{id:r})},getResponseHeader:function(e){return this.headers[e]},getAllResponseHeaders:function(){return this.headers}};var u=n.queue(function(){k.cmd(i,"upload",{url:p(e.url),data:a,files:r?s:null,headers:e.headers||{},callback:d(function t(i){var r=i.type,a=i.result;n.log("FlashAPI.upload."+r+":",i),"progress"==r?(i.loaded=Math.min(i.loaded,i.total),i.lengthComputable=!0,e.progress(i)):"complete"==r?(h(t),"string"==typeof a&&(l.responseText=a.replace(/%22/g,'"').replace(/%5c/g,"\\").replace(/%26/g,"&").replace(/%25/g,"%")),l.end(i.status||200)):"abort"!=r&&"error"!=r||(l.end(i.status||0,i.message),h(t))})})});o(s,function(e){u.inc(),n.getInfo(e,u.next)}),u.check()}})}};n.Camera.fallback=function(){s.push(arguments)},n.Flash=k,n.newImage("data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",function(e,t){n.support.dataURI=!(1!=t.width||1!=t.height),k.init()})}()}(window,window.jQuery,FileAPI),function(e){e(FileAPI)}(function(e){if(window.navigator&&window.navigator.platform&&/iP(hone|od|ad)/.test(window.navigator.platform)){var t=e.renderImageToCanvas;e.detectSubsampling=function(e){var t,n;return e.width*e.height>1048576?(t=document.createElement("canvas"),t.width=t.height=1,n=t.getContext("2d"),n.drawImage(e,-e.width+1,0),0===n.getImageData(0,0,1,1).data[3]):!1},e.detectVerticalSquash=function(e,t){var n,i,r,a,o,s=e.naturalHeight||e.height,l=document.createElement("canvas"),u=l.getContext("2d");for(t&&(s/=2),l.width=1,l.height=s,u.drawImage(e,0,0),n=u.getImageData(0,0,1,s).data,i=0,r=s,a=s;a>i;)o=n[4*(a-1)+3],0===o?r=a:i=a,a=r+i>>1;return a/s||1},e.renderImageToCanvas=function(n,i,r,a,o,s,l,u,c,f){if("image/jpeg"===i._type){var d,h,p,m,g=n.getContext("2d"),v=document.createElement("canvas"),y=1024,b=v.getContext("2d");if(v.width=y,v.height=y,g.save(),d=e.detectSubsampling(i),d&&(r/=2,a/=2,o/=2,s/=2),h=e.detectVerticalSquash(i,d),d||1!==h){for(a*=h,c=Math.ceil(y*c/o),f=Math.ceil(y*f/s/h),u=0,m=0;s>m;){for(l=0,p=0;o>p;)b.clearRect(0,0,y,y),b.drawImage(i,r,a,o,s,-p,-m,o,s),g.drawImage(v,0,0,y,y,l,u,c,f),p+=y,l+=c;m+=y,u+=f}return g.restore(),n}}return t(n,i,r,a,o,s,l,u,c,f)}}}),function(e){var t=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype,n=e.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),i=n&&e.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),r=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,a=(n||r)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(e){var t,a,o,s,l,u;for(t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):decodeURIComponent(e.split(",")[1]),a=new ArrayBuffer(t.length),o=new Uint8Array(a),s=0;s<t.length;s+=1)o[s]=t.charCodeAt(s);return l=e.split(",")[0].split(":")[1].split(";")[0],n?new Blob([i?o:a],{type:l}):(u=new r,u.append(a),u.getBlob(l))};e.HTMLCanvasElement&&!t.toBlob&&(t.mozGetAsFile?t.toBlob=function(e,n,i){e(i&&t.toDataURL&&a?a(this.toDataURL(n,i)):this.mozGetAsFile("blob",n))}:t.toDataURL&&a&&(t.toBlob=function(e,t,n){e(a(this.toDataURL(t,n)))})),e.dataURLtoBlob=a}(window);var file=FileAPI,ajax={};ajax.get=function(e,t){var n=createXHR();return n.open("GET",e),n.onreadystatechange=function(){4==n.readyState&&200==n.status?t(null,n.responseText):t(!0)},n.send(null),n},ajax.post=function(e,t,n){var i=createXHR(),r="?";for(var a in t)t.hasOwnProperty(a)&&(r+=a+"="+t[a]);return i.open("POST",e),i.onreadystatechange=function(){4==i.readyState&&200==i.status?n(null,i.responseText):n(!0)},i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.send(r),i},ajax.postBlob=function(e,t,n,i){var r=createXHR();return utils.isFunction(n)&&(i=n,n={}),r.open("POST",e),r.onreadystatechange=function(){i(4==r.readyState&&200==r.status?null.xhr.responseText:!0)},n.headers&&utils.each(n.headers,function(e,t){r.setRequestHeader(t,e)}),r.send(t),r};var Asset$3=_Asset({}),imageViewTranslations$1={weight:"w",height:"h",quality:"q"},_Image=function(e){function t(e,n,i){babelHelpers.classCallCheck(this,t);var r=babelHelpers.possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this)),a=utils.objExtend(utils.objClone(n.config),{separate:"-"},i);return r.key=e,r.parent=n,r.config=a,r}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"imageInfo",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?noop$3:arguments[0];return new Promise(function(n,i){var r=e.url()+"?imageInfo";ajax.get(r,function(e,r){if(e)return i(e),t(e);var a=JSON.parse(r);n(a),t(null,a)})})}},{key:"exif",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?noop$3:arguments[0];return new Promise(function(n,i){var r=e.url()+"?exif";ajax.get(r,function(e,r){if(e)return i(e),t(e);var a=JSON.parse(r);n(a),t(null,a)})})}},{key:"imageView",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?noop$3:arguments[1],i=new Promise(function(r,a){var o=e.mode;delete e.mode;var s=t.url(),l={};utils.each(e,function(e,t){imageViewTranslations$1.hasOwnProperty(t)&&(t=imageViewTranslations$1[t]),l[t]=e}),s+=utils.format("?imageView/%d%s",o,genOptUrl$1(l));var u=new Image;u.src=s,i.image=u,r(u),n(null,u)});return i}},{key:"imageMogr",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?noop$3:arguments[1],i=new Promise(function(r,a){var o=t.url(),s={};utils.objExtend(s,e),o+=utils.format("?imageMogr/v2/auto-orient%s",genOptUrl$1(s));var l=new Image;l.src=o,i.image=l,r(l),n(null,l)});return i}},{key:"watermark",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?noop$3:arguments[1],i=new Promise(function(r){var a=t.url(),o={},s=e.mode;delete e.mode,utils.objExtend(o,e),o.image=utils.safeEncode(o.image),a+=utils.format("?watermark/%d%s",s,genOptUrl$1(o));var l=new Image;l.src=a,i.image=l,r(l),n(null,l)});return i}}]),t}(Asset$3);_Image.extend=function(e){return e.imageView=function(e,t){var n=this;return t=t||noop$3,new Promise(function(i){var r=file.Image(n);r._load(n,function(n,i){if(n)return t(n),promise.reject(n);var a={};switch(e.mode=e.mode||1,e.mode){case 1:utils.objExtend(a,{dw:e.width||e.height,dh:e.height||e.width,resize:"preview"});break;case 2:var o=i.width/i.height,s=e.hasOwnProperty("width"),l=e.hasOwnProperty("height");switch(!0){case s&&l:utils.objExtend(a,{dw:e.width,dh:e.height,resize:"max"});break;case s&&!l:utils.objExtend(a,{dw:e.width,dh:e.width/o,resize:"max"});break;case!s&&l:utils.objExtend(a,{dw:e.height*o,dh:e.height,resize:"max"})}}r.set(a).get(function(e,n){return e?(t(e),promise.reject(e)):(t(null,n),void promise.resolve(n))})})})},e.imageMogr=function(e,t){var n=this;return t=t||noop$3,new Promise(function(i,r){var a=file.Image(n);a._load(n,function(n,o){if(n)return t(null),promise.reject(n);var s={},l=o.width/o.height,u=e.thumbnail;switch(u.mode){case 1:utils.objExtend(s,{dw:u.width||u.height,dh:u.height||u.width,resize:"preview",sx:(o.width-u.width)/2,sy:(o.height-u.height)/2,sw:u.width||u.height,sh:u.height||u.width});break;case 2:var c=u.hasOwnProperty("width"),f=u.hasOwnProperty("height");switch(!0){case c&&f:utils.objExtend(s,{dw:u.width,dh:u.height,resize:"max"});break;case c&&!f:utils.objExtend(s,{dw:u.width,dh:u.width/l,resize:"max"});break;case!c&&f:utils.objExtend(s,{dw:u.height*l,dh:u.height,resize:"max"})}}var d=e.crop,h=d.hasOwnProperty("width"),p=d.hasOwnProperty("height");switch(d.x=d.x||0,d.y=d.y||0,d.gravity,!0){case h&&!p:d.height=d.width/l;break;case!h&&p:d.width=d.height*l}d.rotate=d.rotate||0,utils.objExtend(s,{sx:d.x,sy:d.y,sw:d.width,sh:d.height,deg:d.rotate}),a.set(s).get(function(e,n){return e?(t(e),r(e)):(t(null,n),void i(n))})})})},e.imageInfo=function(e){var t=this;return e=e||noop$3,new Promise(function(n,i){var r=file.Image(t);r._load(t,function(t,r){if(t)return e(t),i(t);var a={width:r.width,height:r.height};e(null,a),n(a)})})},e.getImage=function(){return file.Image(this)},e};var Asset$2=null,globalConfig=null,Bucket$1=function(){function Bucket(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(babelHelpers.classCallCheck(this,Bucket),this.name=e,this.queue=[],this.config=utils.objExtend(globalConfig,t,{scope:e}),!this.config.url)throw new ReferenceError("You should set the url of the bucket.");/\/$/.test(this.config.url)&&(this.config.url=this.config.url.substr(0,this.config.url.length-1))}return babelHelpers.createClass(Bucket,[{key:"putFile",value:function(e,t,n,i){var r=arguments,a=this;return new Promise(function(o,s){switch(r.length){case 3:utils.isFunction(n)?(i=n,n={}):i=noop$2;break;case 2:n={},i=noop$2}var l=(utils.objExtend(utils.objClone(a.config),n),a.config.putToken),u="http://"+globalConfig.uploadUrl,c=!!window.ActiveXObject,f={token:l,key:e};c&&(f.accept="text/plain; charset=utf-8");var d=file.upload({url:u,data:f,files:{file:t},upload:function(i,r){(n.before&&utils.isFunction(n.before)?n.before:noop$2).call(null,i,e,t)},progress:function(e){var t=e.loaded/e.total*100(n.progress&&utils.isFunction(n.progress)?n.progress:noop$2).call(null,t,e.loaded,e.total)},complete:function(t,n){if(t)return i(t),s(t);if(window.JSON){JSON.parse(d.responseText)}else{d.responseText}var r=this.key(e);i(null,reply,r,d,n),o(reply,r,d,n)}})})}},{key:"putChunkedFile",value:function putChunkedFile(key,_file,options,callback){var _this2=this;return new Promise(function(resolve,reject){var config=utils.objExtend(utils.objClone(_this2.config),options),putToken=_this2.config.putToken;options.blockSize=options.blockSize||file.MB.form(5);var uploadUrl="http://"+globalConfig.uploadUrl+"/mkblk/"+options.blockSize,blockCtxes=[];if(utils.isFunction(_file.slice))!function loop(url,start,_callback,host){var end=start+options.blockSize;if(!(start<_file.size))return _callback(host);var blob=_file.slice(start,end);ajax.postBlob(url,blob,{headers:{"Content-Type":"application/octet-stream",Authorization:utils.format("UpToken %s",putToken)}},function(err,reply){if(err)return callback(err),reject(err);var replyData=eval(reply);blockCtxes.push(replyData.ctx);var host=replyData.host;loop(utils.format("%s/bput/%s/%s",host,replyData.ctx,end),end,_callback,host)})}(uploadUrl,0,function(e){var t=self.key(key),n=utils.format("%s/rs-mkfile/%s/fsize/%s/mimeType/%s",e,t.entryUrl(),_file.size,_file.type);options.params&&utils.format("/params/%s"),options.meta&&(n+=utils.format("/meta/%s",utils.safeEncode(options.meta))),options.customer&&(n+=utils.format("/customer/%s",options.customer)),options.rotate&&(n+=utils.format("/rotate/%s",options.rotate)),ajax.post()});else{var err="no support chunk";reject(err),callback(err)}})}},{key:"getFile",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?noop$2:arguments[1];return new Promise(function(i,r){var a=t.config.getToken||"",o=null;o=t.config.url?utils.format("%s/%s?e=3600&token=%s",t.url(),e,a):utils.format("http://%s.qiniudn.com/%s?e=3600&token=%s",t.name,e,a),ajax.get(o,function(e,t){return e?(n(e),r(e)):(n(null,t),void i(t))})})}},{key:"url",value:function(){return this.config.url}},{key:"key",value:function(e){return new Asset$2(e,this)}},{key:"image",value:function(e){return new _Image(e,this)}}]),Bucket}();Bucket$1.Image=_Image,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(e){if(!isNumber(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},EventEmitter.prototype.emit=function(e){var t,n,i,r,a,o;if(this._events||(this._events={}),"error"===e&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[e],isUndefined(n))return!1;if(isFunction(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:r=Array.prototype.slice.call(arguments,1),n.apply(this,r)}else if(isObject(n))for(r=Array.prototype.slice.call(arguments,1),o=n.slice(),i=o.length,a=0;i>a;a++)o[a].apply(this,r);return!0},EventEmitter.prototype.addListener=function(e,t){var n;if(!isFunction(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,isFunction(t.listener)?t.listener:t),this._events[e]?isObject(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,isObject(this._events[e])&&!this._events[e].warned&&(n=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())),this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(e,t){function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}if(!isFunction(t))throw TypeError("listener must be a function");var i=!1;return n.listener=t,this.on(e,n),this},EventEmitter.prototype.removeListener=function(e,t){var n,i,r,a;if(!isFunction(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],r=n.length,i=-1,n===t||isFunction(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(isObject(n)){for(a=r;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){i=a;break}if(0>i)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},EventEmitter.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],isFunction(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},EventEmitter.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?isFunction(this._events[e])?[this._events[e]]:this._events[e].slice():[]},EventEmitter.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(isFunction(t))return 1;if(t)return t.length}return 0},EventEmitter.listenerCount=function(e,t){return e.listenerCount(t)};var _configData={uploadUrl:"up.qiniu.com",rsUrl:"rs.qbox.me",rsfUrl:"rsf.qbox.me"},Asset=_Asset(_configData),Bucket=_Bucket(_configData),qiniu={};return qiniu.config=function(e,t){if(arguments.length>1&&e instanceof String)qiniu.set(e,t);else switch(!0){case utils.isString(e):return qiniu.get(e);case utils.isObject(e):for(var n in e)!function(t){qiniu.set(t,e[t])}(n)}return this},qiniu.set=function(e,t){return _configData[e]=t,this},qiniu.get=function(e){return _configData[e]},qiniu.bind=function(e,t){t=t||{};var n=".qiniu-transparent {     z-index: 1000;     zoom: 1;     opacity: 0;     -moz-opacity: 0;     -khtml-opacity: 0;     filter: 'alpha(opacity=0)';     *filter: alpha(opacity=0);   }",i=document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",r.styleSheet?r.styleSheet.cssText=n:r.appendChild(document.createTextNode(n)),i.appendChild(r);var a=document.createElement("div"),o='<div class="js-fileapi-wrapper qiniu-transparent"></div>';a.innerHTML=o;var s=a.firstChild;if(e.jquery)e.before(s).addClass("select-btn");else{var l=e.parentNode;l.insertBefore(s,e)}var u=document.createElement("input");return u.type="file",u.className="qiniu-transparent",u.multiple=!0,s.appendChild(u),e=e.jquery?e.get(0):e,utils.css(s,{top:e.style.top,right:e.style.right,position:"absolute",width:e.offsetWidth+5,height:e.offsetHeight+5,margin:e.style.margin}),utils.css(u,{width:e.offsetWidth+5,height:e.offsetHeight+5,position:"relative"}),file.event.on(u,"change",function(e){var n=file.getFiles(e),i=t.filter||!1,r={image:/image/,audio:/audio/,video:/video/,media:/audio|video/};switch(!0){case utils.isString(i):r[i]&&(n=file.filter(n,function(e){return r[i].test(e.type)}));break;case utils.isArray(i):for(var a=0;a<i.length;a++)!function(e){n=file.filter(n,function(t){return r[i[e]].test(t.type)})}(a);break;case i instanceof RegExp:n=file.filter(n,function(e){return i.test(e.type)})}for(var a=0;a<n.length;a++)!function(e){qiniu.emit("file",_Image.extend(n[e]))}(a)}),this},qiniu.bind.dnd=function(e,t){return file.support.dnd?(file.event.dnd(e.jquery?e.get(0):e,function(e){var n=t.filter||!1,i={image:/image/,audio:/audio/,video:/video/,media:/audio|video/};switch(!0){case utils.isString(n):i[n]&&(e=file.filter(e,function(e){return i[n].test(e.type)}));break;case utils.isArray(n):for(var r=0;r<n.length;r++)!function(t){e=file.filter(e,function(e){return i[n[t]].test(e.type)})}(r);break;case n instanceof RegExp:e=file.filter(e,function(e){return n.test(e.type)})}for(var r=0;r<e.length;r++)!function(t){qiniu.emit("file",_Image.extend(e[t]))}(r)}),file.event.on(e.jquery?e.get(0):e,"dragover dragleave",function(e){switch(e.type){case"dragover":(t.over&&utils.isFunction(t.over)?t.over:noop).call(null),qiniu.emit("over");break;case"dragleave":(t.out&&utils.isFunction(t.out)?t.out:noop).call(null),qiniu.emit("out")}}),(t.success&&utils.isFunction(t.success)?t.success:noop).call(null),qiniu.emit("dnd.success")):(qiniu.emit("dnd.error","no support"),(t.error&&utils.isFunction(t.error)?t.error:noop).call(null,"no support")),qiniu},qiniu.supportDnd=file.support.dnd,qiniu.bucket=function(e,t){return new Bucket(e,t)},qiniu.Asset=Asset,qiniu.Bucket=Bucket,qiniu.Image=_Image,utils.objExtend(qiniu,EventEmitter.prototype),EventEmitter.call(qiniu),qiniu});