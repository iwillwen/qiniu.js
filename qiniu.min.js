function def(a,b,c){var d="undefined"!=typeof define,e="undefined"!=typeof exports;if(!c&&b instanceof Function&&(c=b,b=[]),d)define(a,b,c);else if(e)exports=c(require,exports,f);else{var f={exports:{}};def.cache[a]=this[a]=f.exports=c(function(a){return def.cache.hasOwnProperty(a)?def.cache[a]:null},f.exports,f)}}def.cache={},def("qiniu.utils",function(){var a=[].slice,b=[].forEach||!1,c={slice:a,noop:function(){return!1},inherits:function(a,b){a.super_=b,a.prototype=c.objCreate(c.objExtend(c.objClone(b.prototype),{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}))},isString:function(a){return"string"==typeof a},isObject:function(a){return a instanceof Object},isArray:function(a){return a instanceof Array},isFunction:function(a){return a instanceof Function},isUndefine:function(a){return void 0===a},objClone:function(a){return c.isObject(a)?c.isArray(a)?a.slice():c.objExtend({},a):a},objExtend:function(b){for(var c=a.call(arguments,1),d=0;d<c.length;d++)!function(a){var d=c[a];if(d)for(var e in d)d.hasOwnProperty(e)&&(b[e]=d[e])}(d);return b},objCreate:function(a){function b(){}if(arguments.length>1)throw new Error("Object.create implementation only accepts the first parameter.");return b.prototype=a,new b},objKeys:function(a){if(c.isFunction(a.key))return a.keys();var b=[];for(var d in a)a.hasOwnProperty(d)&&b.push(d);return b},each:function(a,d,e){if(null!=a)if(b&&a.forEach===b)a.forEach(d,e);else if(a.length===+a.length){for(var f=0,g=a.length;g>f;f++)if(d.call(e,a[f],f,a)===!1)return}else for(var h=c.objKeys(a),f=0,g=h.length;g>f;f++)if(d.call(e,a[h[f]],h[f],a)===!1)return},format:function(b){if(!c.isString(b)){for(var d=[],e=0;e<arguments.length;e++)d.push(arguments[e]);return d.join(" ")}var f=a.call(arguments,1),e=0,g=arguments.length,h=/%[sd%]/g,i=String(b).replace(h,function(a){if("%%"===a)return"%";if(e>=g)return a;switch(a){case"%s":return String(f[e++]);case"%d":return Number(f[e++]);default:return a}});return i},safeEncode:function(){var a=btoa("base64"),b=a.replace(/\//g,"_").replace(/\+/g,"-");return b},css:function(a,b){if(a&&a.style){var c,d;for(c in b){d=b[c],"number"==typeof d&&(d+="px");try{a.style[c]=d}catch(e){}}}}};return c}),def("qiniu.deps.Ajax",["qiniu.utils"],function(a,b){function c(){if(window.ActiveXObject)var a=new ActiveXObject("Microsoft.XMLHTTP");else if(window.XMLHttpRequest)var a=new XMLHttpRequest;return a}if("undefined"!=typeof define&&define.amd)var d=arguments[0];else var d=a("qiniu.utils");var e=b;return e.get=function(a,b){var d=c();return d.open("GET",a),d.onreadystatechange=function(){4==d.readyState&&200==d.status?b(null,d.responseText):b(!0)},d.send(null),d},e.post=function(a,b,d){var e=c(),f="?";for(var g in b)b.hasOwnProperty(g)&&(f+=g+"="+b[g]);return e.open("POST",a),e.onreadystatechange=function(){4==e.readyState&&200==e.status?d(null,e.responseText):d(!0)},e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.send(f),e},e.postBlob=function(a,b,e,f){var g=c();return d.isFunction(e)&&(f=e,e={}),g.open("POST",a),g.onreadystatechange=function(){4==g.readyState&&200==g.status?f(null.xhr.responseText):f(!0)},e.headers&&d.each(e.headers,function(a,b){g.setRequestHeader(b,a)}),g.send(b),g},e}),def("qiniu.deps.Events",["qiniu.utils"],function(a,b){function c(){this._events=this._events||{},this._maxListeners=this._maxListeners||h}function d(a){this.results=null,this.errors=null,this.ended=!1,"function"==typeof a&&this.done(a)}var e=[].slice;if("undefined"!=typeof define&&define.amd)var f=arguments[0];else var f=a("qiniu.utils");var g=b,h=10;return c.prototype.setMaxListeners=function(a){if("number"!=typeof a||0>a)throw TypeError("n must be a positive number");this._maxListeners=a},c.prototype.emit=function(a){var b,c,d,e,f,g;if(this._events||(this._events={}),"error"===a&&(!this._events.error||"object"==typeof this._events.error&&!this._events.error.length)){if(b=arguments[1],!this.domain)throw b instanceof Error?b:TypeError('Uncaught, unspecified "error" event.');return b||(b=new TypeError('Uncaught, unspecified "error" event.')),!1}if(c=this._events[a],"undefined"==typeof c)return!1;if("function"==typeof c)switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(d=arguments.length,e=new Array(d-1),f=1;d>f;f++)e[f-1]=arguments[f];c.apply(this,e)}else if("object"==typeof c){for(d=arguments.length,e=new Array(d-1),f=1;d>f;f++)e[f-1]=arguments[f];for(g=c.slice(),d=g.length,f=0;d>f;f++)g[f].apply(this,e)}return!0},c.prototype.addListener=function(a,b){var c;if("function"!=typeof b)throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,"function"==typeof b.listener?b.listener:b),this._events[a]?"object"==typeof this._events[a]?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,"object"!=typeof this._events[a]||this._events[a].warned||(c=this._maxListeners,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),console.trace())),this},c.prototype.on=c.prototype.addListener,c.prototype.once=function(a,b){function c(){this.removeListener(a,c),b.apply(this,arguments)}if("function"!=typeof b)throw TypeError("listener must be a function");return c.listener=b,this.on(a,c),this},c.prototype.removeListener=function(a,b){var c,d,e,f;if("function"!=typeof b)throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],e=c.length,d=-1,c===b||"function"==typeof c.listener&&c.listener===b)this._events[a]=void 0,this._events.removeListener&&this.emit("removeListener",a,b);else if("object"==typeof c){for(f=e;f-->0;)if(c[f]===b||c[f].listener&&c[f].listener===b){d=f;break}if(0>d)return this;1===c.length?(c.length=0,this._events[a]=void 0):c.splice(d,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},c.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&(this._events[a]=void 0),this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],"function"==typeof c)this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);return this._events[a]=void 0,this},c.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?"function"==typeof this._events[a]?[this._events[a]]:this._events[a].slice():[]},c.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?"function"==typeof a._events[b]?1:a._events[b].length:0},g.EventEmitter=c,f.inherits(d,c),d.prototype.resolve=function(){var a=e.call(arguments);return this.emit("resolve",a),this.ended=!0,this.results=a,this},d.prototype.reject=function(){var a=e.call(arguments);return this.emit("reject",a),this.ended=!0,this.errors=a,this},d.prototype.then=function(a,b){var c=new d,e=this;return a=a||f.noop,b=b||f.noop,e.done(function(){var b=a.apply(e,arguments);b instanceof d?b.then(function(){c.resolve.apply(c,arguments)},function(a){c.reject(a)}):b instanceof Error&&c.reject(b)}).fail(function(a){b.call(e,a),c.reject(a)}),c},d.prototype.done=function(a){var b=this;return b.ended?null!==b.results&&a.apply(b,b.results):b.on("resolve",function(c){var e=a.apply(b,c);e instanceof d&&e.fail(b.reject.bind(b))}),b},d.prototype.fail=function(a){var b=this;return b.ended?null!==b.errors&&a.apply(b,b.errors):b.on("reject",function(c){a.apply(b,c)}),b},g.Promise=d,g}),def("qiniu.deps.file",function(){return function(a){var b,c=a.HTMLCanvasElement&&a.HTMLCanvasElement.prototype;if(b=a.Blob)try{b=Boolean(new Blob)}catch(d){b=!1}var e=b;if((b=e)&&(b=a.Uint8Array))try{b=100===new Blob([new Uint8Array(100)]).size}catch(f){b=!1}var g=b,h=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder||a.MSBlobBuilder,i=(e||h)&&a.atob&&a.ArrayBuffer&&a.Uint8Array&&function(a){var b,c,d,f;for(b=0<=a.split(",")[0].indexOf("base64")?atob(a.split(",")[1]):decodeURIComponent(a.split(",")[1]),c=new ArrayBuffer(b.length),d=new Uint8Array(c),f=0;f<b.length;f+=1)d[f]=b.charCodeAt(f);return a=a.split(",")[0].split(":")[1].split(";")[0],e?new Blob([g?d:c],{type:a}):(d=new h,d.append(c),d.getBlob(a))};a.HTMLCanvasElement&&!c.toBlob&&(c.mozGetAsFile?c.toBlob=function(a,b){a(this.mozGetAsFile("blob",b))}:c.toDataURL&&i&&(c.toBlob=function(a,b){a(i(this.toDataURL(b)))})),"function"==typeof define&&define.amd?define(function(){return i}):a.dataURLtoBlob=i}(this),function(a,b){function c(a,b,c){if(a)if(k(a))for(var d=0,e=a.length;e>d;d++)d in a&&b.call(c,a[d],d,a);else for(d in a)a.hasOwnProperty(d)&&b.call(c,a[d],d,a)}function d(a,b,d){if(a){var e=O.uid(a);K[e]||(K[e]={}),c(b.split(/\s+/),function(b){v?v.event.add(a,b,d):(K[e][b]||(K[e][b]=[]),K[e][b].push(d),a.addEventListener?a.addEventListener(b,d,!1):a.attachEvent?a.attachEvent("on"+b,d):a["on"+b]=d)})}}function e(a,b,d){if(a){var e=O.uid(a),f=K[e]||{};c(b.split(/\s+/),function(b){if(v)v.event.remove(a,b,d);else{for(var c=f[b]||[],e=c.length;e--;)if(c[e]===d){c.splice(e,1);break}a.addEventListener?a.removeEventListener(b,d,!1):a.detachEvent?a.detachEvent("on"+b,d):a["on"+b]=null}})}}function f(a,b,c){d(a,b,function f(d){e(a,b,f),c(d)})}function g(a,b,c,d,e){a={type:c.type||c,target:a,result:d},O.extend(a,e),b(a)}function h(a,c,f,h){if(O.isFile(a)&&s&&s.prototype["readAs"+f]){var i=new s;d(i,M,function k(b){var d=b.type;"progress"==d?g(a,c,b,b.target.result,{loaded:b.loaded,total:b.total}):"loadend"==d?(e(i,M,k),i=null):g(a,c,b,b.target.result)});try{h?i["readAs"+f](h,a):i["readAs"+f](a)}catch(j){g(a,c,"error",b,{error:j.toString()})}}else g(a,c,"error",b,{error:"filreader_not_support_"+f})}function i(a){var b;return a.getAsEntry?b=a.getAsEntry():a.webkitGetAsEntry&&(b=a.webkitGetAsEntry()),b}function j(a,b){if(a)if(a.isFile)a.file(function(a){b(!1,[a])},function(){b("entry_file")});else if(a.isDirectory){var c=[];a.createReader().readEntries(function(a){O.afor(a,function(a,d){j(d,function(d,e){d||(c=c.concat(e)),a?a():b(!1,c)})})},function(){b("directory_reader")})}else j(i(a),b);else b("empty_entry")}function k(a){return"object"==typeof a&&a&&"length"in a}function l(b){return b.target||(b.target=a.event&&a.event.srcElement||x),3===b.target.nodeType&&(b.target=event.target.parentNode),b}var m=1,n=function(){},o=navigator.userAgent,p=a.createObjectURL&&a||a.URL&&URL.revokeObjectURL&&URL||a.webkitURL&&webkitURL,q=a.Blob,r=a.File,s=a.FileReader,t=a.FormData,u=a.XMLHttpRequest,v=a.jQuery,w=!(!r||!s||!a.Uint8Array&&!t&&!u.prototype.sendAsBinary||/safari\//i.test(o)&&/windows/i.test(o)),o=w&&"withCredentials"in new u,q=w&&!!q&&!(!q.prototype.webkitSlice&&!q.prototype.mozSlice&&!q.prototype.slice),x=a.document,y=a.dataURLtoBlob,z=/img/i,A=/canvas/i,B=/img|canvas/,C=/input/i,D=/^data:[^,]+,/,E=Math.pow,F=Math.round,G=Number,t=function(a){return F(a*this)},H=new G(1024),I=new G(E(H,2)),J=new G(E(H,3)),E=new G(E(H,4)),K={},L=[],M="abort progress error load loadend",N="status statusText readyState response responseXML responseText responseBody".split(" "),O={version:"1.2.5",cors:!1,html5:!0,debug:!1,pingUrl:!1,staticPath:"http://phist.qiniudn.com/",flashUrl:0,flashImageUrl:0,accept:{"image/*":"art bm bmp dwg dxf cbr cbz fif fpx gif ico iefs jfif jpe jpeg jpg jps jut mcf nap nif pbm pcx pgm pict pm png pnm qif qtif ras rast rf rp svf tga tif tiff xbm xbm xpm xwd","audio/*":"m4a flac aac rm mpa wav wma ogg mp3 mp2 m3u mod amf dmf dsm far gdm imf it m15 med okt s3m stm sfx ult uni xm sid ac3 dts cue aif aiff wpl ape mac mpc mpp shn wv nsf spc gym adplug adx dsp adp ymf ast afc hps xs","video/*":"m4v 3gp nsv ts ty strm rm rmvb m3u ifo mov qt divx xvid bivx vob nrg img iso pva wmv asf asx ogm m2v avi bin dat dvr-ms mpg mpeg mp4 mkv avc vp3 svq3 nuv viv dv fli flv wpl"},chunkSize:0,chunkUploadRetry:0,chunkNetworkDownRetryTimeout:2e3,KB:(H.from=t,H),MB:(I.from=t,I),GB:(J.from=t,J),TB:(E.from=t,E),expando:"fileapi"+(new Date).getTime(),uid:function(a){return a?a[O.expando]=a[O.expando]||O.uid():(++m,O.expando+m)},log:function(){O.debug&&a.console&&console.log&&(console.log.apply?console.log.apply(console,arguments):console.log([].join.call(arguments," ")))},getXHR:function(){var b;if(u)b=new u;else if(a.ActiveXObject)try{b=new ActiveXObject("MSXML2.XMLHttp.3.0")}catch(c){b=new ActiveXObject("Microsoft.XMLHTTP")}return b},isArray:k,support:{dnd:o&&"ondrop"in x.createElement("div"),cors:o,html5:w,chunked:q,dataURI:!0},event:{on:d,off:e,one:f,fix:l},throttle:function(b,c){var d,e;return function(){e=arguments,d||(b.apply(a,e),d=setTimeout(function(){d=0,b.apply(a,e)},c))}},F:function(){},parseJSON:function(b){return a.JSON&&JSON.parse?JSON.parse(b):new Function("return ("+b.replace(/([\r\n])/g,"\\$1")+");")()},trim:function(a){return a=String(a),a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")},defer:function(){var a,c,d=[],e={resolve:function(b,f){for(e.resolve=n,c=b||!1,a=f;f=d.shift();)f(c,a)},then:function(e){c!==b?e(c,a):d.push(e)}};return e},queue:function(a){var b=0,c=0,d=!1,e=!1,f={inc:function(){c++},next:function(){b++,setTimeout(f.check,0)},check:function(){b>=c&&!d&&f.end()},isFail:function(){return d},fail:function(){!d&&a(d=!0)},end:function(){e||(e=!0,a())}};return f},each:c,afor:function(a,b){var c=0,d=a.length;k(a)&&d--?function e(){b(d!=c&&e,a[c],c++)}():b(!1)},extend:function(a){return c(arguments,function(b){c(b,function(b,c){a[c]=b})}),a},isFile:function(a){return w&&a&&a instanceof r},isCanvas:function(a){return a&&A.test(a.nodeName)},getFilesFilter:function(a){return(a="string"==typeof a?a:a.getAttribute&&a.getAttribute("accept")||"")?RegExp("("+a.replace(/\./g,"\\.").replace(/,/g,"|")+")$","i"):/./},readAsDataURL:function(a,b){O.isCanvas(a)?g(a,b,"load",O.toDataURL(a)):h(a,b,"DataURL")},readAsBinaryString:function(a,b){s&&s.prototype.readAsBinaryString?h(a,b,"BinaryString"):h(a,function(a){if("load"==a.type)try{a.result=O.toBinaryString(a.result)}catch(c){a.type="error",a.message=c.toString()}b(a)},"DataURL")},readAsArrayBuffer:function(a,b){h(a,b,"ArrayBuffer")},readAsText:function(a,b,c){c||(c=b,b="utf-8"),h(a,c,"Text",b)},toDataURL:function(a){return"string"==typeof a?a:a.toDataURL?a.toDataURL("image/png"):void 0},toBinaryString:function(b){return a.atob(O.toDataURL(b).replace(D,""))},readAsImage:function(a,c,d){if(O.isFile(a))if(p){var h=p.createObjectURL(a);h===b?g(a,c,"error"):O.readAsImage(h,c,d)}else O.readAsDataURL(a,function(b){"load"==b.type?O.readAsImage(b.result,c,d):(d||"error"==b.type)&&g(a,c,b,null,{loaded:b.loaded,total:b.total})});else O.isCanvas(a)?g(a,c,"load",a):z.test(a.nodeName)?a.complete?g(a,c,"load",a):f(a,"error abort load",function i(b){"load"==b.type&&p&&p.revokeObjectURL(a.src),e(a,"error abort load",i),g(a,c,b,a)}):a.iframe?g(a,c,{type:"error"}):(h=new Image,h.src=a.dataURL||a,O.readAsImage(h,c,d))},checkFileObj:function(a){var b={},d=O.accept;return"object"==typeof a?b=a:b.name=(a+"").split(/\\|\//g).pop(),null==b.type&&(b.type=b.name.split(".").pop()),c(d,function(a,c){a=RegExp(a.replace(/\s/g,"|"),"i"),a.test(b.type)&&(b.type=c.split("/")[0]+"/"+b.type)}),b},getDropFiles:function(a,b){var d=[],e=(a.originalEvent||a||"").dataTransfer||{},g=k(e.items)&&e.items[0]&&i(e.items[0]),h=O.queue(function(){b(d)});c((g?e.items:e.files)||[],function(a){if(h.inc(),g)j(a,function(a,b){!a&&d.push.apply(d,b),h.next()});else{var b=function(b){b&&d.push(a),h.next()};if(!a.type&&0==a.size%4096&&102400>=a.size)if(s)try{var c=new s;f(c,M,function(a){a="error"!=a.type,b(a),a&&c.abort()}),c.readAsDataURL(a)}catch(e){b(!1)}else b(null);else b(!0)}}),h.check()},getFiles:function(a,b,c){var d=[];return c?(O.filterFiles(O.getFiles(a),b,c),null):(a.jquery&&(a.each(function(){d=d.concat(O.getFiles(this))}),a=d,d=[]),"string"==typeof b&&(b=O.getFilesFilter(b)),a.originalEvent?a=l(a.originalEvent):a.srcElement&&(a=l(a)),a.dataTransfer?a=a.dataTransfer:a.target&&(a=a.target),a.files?d=a.files:!w&&C.test(a&&a.tagName)?O.trim(a.value)&&(d=[O.checkFileObj(a.value)],d[0].blob=a,d[0].iframe=!0):k(a)&&(d=a),O.filter(d,function(a){return!b||b.test(a.name)}))},getInfo:function(a,b){var c={},d=L.concat();O.isFile(a)?function e(){var f=d.shift();f?f.test(a.type)?f(a,function(a,d){a?b(a):(O.extend(c,d),e())}):e():b(!1,c)}():b("not_support",c)},addInfoReader:function(a,b){b.test=function(b){return a.test(b)},L.push(b)},filter:function(a,b){for(var c,d=[],e=0,f=a.length;f>e;e++)e in a&&(c=a[e],b.call(c,c,e,a)&&d.push(c));return d},filterFiles:function(a,b,c){if(a.length){var d,e=a.concat(),f=[],g=[];!function h(){e.length?(d=e.shift(),O.getInfo(d,function(a,c){(b(d,a?!1:c)?f:g).push(d),h()})):c(f,g)}()}else c([],a)},upload:function(a){a=O.extend({prepare:O.F,beforeupload:O.F,upload:O.F,fileupload:O.F,fileprogress:O.F,filecomplete:O.F,progress:O.F,complete:O.F,pause:O.F,chunkSize:O.chunkSize,chunkUpoloadRetry:O.chunkUploadRetry},a),a.imageAutoOrientation&&!a.imageTransform&&(a.imageTransform={rotate:"auto"});var b,d=new O.XHR(a),e=this._getFilesDataArray(a.files),f=0,g=0,h=0,i=1,j=this,k=!1;return c(e,function(a){f+=a.size}),d.files=[],c(e,function(a){d.files.push(a.file)}),d.total=f,d.loaded=0,a.beforeupload(d,a),(b=function l(){var b=e.shift(),m=b&&b.file,o=!1,p={};c(a,function(a,b){a&&"object"==typeof a&&(a=O.extend({},a)),p[b]=a}),m&&m.name===O.expando&&(m=null,O.log("[warn] FileAPI.upload() â€” called without files")),("abort"!=d.statusText||d.current)&&b?(k=!1,(d.currentFile=m)&&a.prepare(m,p),this._getFormData(p,b,function(e){g||a.upload(d,a);var k=new O.XHR(O.extend({},p,{upload:m?function(){a.fileupload(m,k,p)}:n,progress:m?function(c){o||(h=g+=0|f*i*(c.loaded/c.total)-h+.5,b.total=c.total,b.loaded=c.loaded,a.fileprogress(c,m,k,p),a.progress({type:c.type,total:f,loaded:d.loaded=g,lengthComputable:!0},m,k,p))}:n,complete:function(e){c(N,function(a){d[a]=k[a]}),o=!0,m&&(b.loaded=b.total,d.loaded=g+=0|g-h+(f*i+.5),a.filecomplete(e,k,m,p)),l.call(j)}}));i=b.size/f,d.abort=function(a){this.current=a,k.abort()},k.send(e)})):(a.complete(200==d.status||201==d.status?!1:d.statusText||"error",d,a),k=!0)}).call(this),d.append=function(a,g){a=O._getFilesDataArray([].concat(a)),c(a,function(a){f+=a.size,d.files.push(a.file),g?e.unshift(a):e.push(a)}),k&&b.call(j)},d.remove=function(a){var b=-1;c(e,function(c){return b++,c.file==a?e.splice(b,1):void 0})},d},_getFilesDataArray:function(a){var b=[],d={};if(C.test(a&&a.tagName)){var e=O.getFiles(a);d[a.name||"file"]=null!==a.getAttribute("multiple")?e:e[0]}else k(a)&&C.test(a[0]&&a[0].tagName)?c(a,function(a){d[a.name||"file"]=O.getFiles(a)}):d=a;return c(d,function f(a,d){k(a)?c(a,function(a){f(a,d)}):a&&a.name&&b.push({name:d,file:a,size:a.size,total:a.size,loaded:0})}),b.length||b.push({file:{name:O.expando}}),b},_getFormData:function(a,b,d){var e=b.file,f=b.name,g=e.name,h=e.type;b=O.support.transform&&a.imageTransform;var i=new O.Form,j=O.queue(function(){d(i)}),k=b&&(0<parseInt(b.maxWidth||b.minWidth||b.width,10)||b.rotate);O.Image&&b&&(/image/.test(e.type)||B.test(e.nodeType))?(j.inc(),k&&(b=[b]),O.Image.transform(e,b,a.imageAutoOrientation,function(b,d){k&&!b?(!y&&!O.flashEngine&&(d[0]=O.toBinaryString(d[0]),i.multipart=!0),i.append(f,d[0],g,h)):(b||(c(d,function(a,b){!y&&!O.flashEngine&&(a=O.toBinaryString(a),i.multipart=!0),i.append(f+"["+b+"]",a,g,h)}),f+="[original]"),(b||a.imageOriginal)&&i.append(f,e,g,h)),j.next()})):g!==O.expando&&i.append(f,e,g),c(a.data,function l(a,b){"object"==typeof a?c(a,function(a,c){l(a,b+"["+c+"]")}):i.append(b,a)}),j.check()},reset:function(a){var b,f;return v?(f=v(a).clone(!0).insertBefore(a).val("")[0],v(a).remove()):(b=a.parentNode,f=b.insertBefore(a.cloneNode(!0),a),f.value="",b.removeChild(a),c(K[O.uid(a)],function(b,g){c(b,function(b){e(a,g,b),d(f,g,b)})})),f},load:function(a,b){var c=O.getXHR();return c?(c.open("GET",a,!0),c.overrideMimeType&&c.overrideMimeType("text/plain; charset=x-user-defined"),d(c,"progress",function(a){a.lengthComputable&&b({type:a.type,loaded:a.loaded,total:a.total},c)}),c.onreadystatechange=function(){if(4==c.readyState)if(c.onreadystatechange=null,200==c.status){a=a.split("/");var d={name:a[a.length-1],size:c.getResponseHeader("Content-Length"),type:c.getResponseHeader("Content-Type")};d.dataURL="data:"+d.type+";base64,"+O.encode64(c.responseBody||c.responseText),b({type:"load",result:d})}else b({type:"error"})},c.send(null)):b({type:"error"}),c},encode64:function(a){var b="",c=0;for("string"!=typeof a&&(a=String(a));c<a.length;){var d=255&a.charCodeAt(c++),e=255&a.charCodeAt(c++),f=255&a.charCodeAt(c++),g=d>>2,d=(3&d)<<4|e>>4;isNaN(e)?e=f=64:(e=(15&e)<<2|f>>6,f=isNaN(f)?64:63&f),b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)}return b}};O.addInfoReader(/^image/,function(a,b){if(!a.__dimensions){var c=a.__dimensions=O.defer();O.readAsImage(a,function(a){var b=a.target;c.resolve("load"==a.type?!1:"error",{width:b.width,height:b.height})})}a.__dimensions.then(b)}),O.event.dnd=function(a,b,c){var e,f;c||(c=b,b=O.F),s?(d(a,"dragenter dragleave dragover",function(a){for(var c=((a.originalEvent||a||"").dataTransfer||{}).types,d=c&&c.length;d--;)~c[d].indexOf("File")&&(a.preventDefault(),f!==a.type&&(f=a.type,"dragleave"!=f&&b.call(a.currentTarget,!0,a),clearTimeout(e),e=setTimeout(function(){b.call(a.currentTarget,"dragleave"!=f,a)},50)))}),d(a,"drop",function(a){a.preventDefault(),f=0,b.call(a.currentTarget,!1,a),O.getDropFiles(a,function(b){c.call(a.currentTarget,b,a)})})):O.log("Drag'n'Drop -- not supported")},v&&!v.fn.dnd&&(v.fn.dnd=function(a,b){return this.each(function(){O.event.dnd(this,a,b)})}),a.FileAPI=O.extend(O,a.FileAPI),O.flashUrl||(O.flashUrl=O.staticPath+"qiniu.js.flash.swf"),O.flashImageUrl||(O.flashImageUrl=O.staticPath+"qiniu.js.flash.image.swf")}(window),function(a,b,c){function d(a,b){return this instanceof d?(this.file=a,this.better=!b,this.matrix={sx:0,sy:0,sw:0,sh:0,dx:0,dy:0,dw:0,dh:0,resize:0,deg:0},void 0):new d(a)}var e=Math.min,f=Math.round,g=!1,h={8:270,3:180,6:90};try{g=-1<b.createElement("canvas").toDataURL("image/png").indexOf("data:image/png")}catch(i){}d.prototype={constructor:d,set:function(b){return a.extend(this.matrix,b),this},crop:function(a,b,d,e){return d===c&&(d=a,e=b,a=b=0),this.set({sx:a,sy:b,sw:d,sh:e||d})},resize:function(a,b,c){return"string"==typeof b&&(c=b,b=a),this.set({dw:a,dh:b,resize:c})},preview:function(a,b){return this.set({dw:a,dh:b||a,resize:"preview"})},rotate:function(a){return this.set({deg:a})},_load:function(b,c){var d=this;a.readAsImage(b,function(a){c.call(d,"load"!=a.type,a.result)})},_apply:function(a,c){var d,e=b.createElement("canvas"),f=this.getMatrix(a),g=e.getContext("2d"),h=f.deg,i=f.dw,j=f.dh,k=a.width,l=a.height,m=a;if(this.better)for(;2<Math.min(k/i,l/j);)k=~~(k/2+.5),l=~~(l/2+.5),d=b.createElement("canvas"),d.width=k,d.height=l,m!==a?(d.getContext("2d").drawImage(m,0,0,m.width,m.height,0,0,k,l),m=d):(m=d,m.getContext("2d").drawImage(a,f.sx,f.sy,f.sw,f.sh,0,0,k,l),f.sx=f.sy=f.sw=f.sh=0);e.width=h%180?j:i,e.height=h%180?i:j,g.rotate(h*Math.PI/180),g.drawImage(m,f.sx,f.sy,f.sw||m.width,f.sh||m.height,180==h||270==h?-i:0,90==h||180==h?-j:0,i,j),c.call(this,!1,e)},getMatrix:function(b){var c=a.extend({},this.matrix),d=c.sw=c.sw||b.width;b=c.sh=c.sh||b.height;var g=c.dw=c.dw||c.sw,h=c.dh=c.dh||c.sh,i=d/b,j=g/h,k=c.resize;return"preview"==k?(g!=d||h!=b)&&(j>=i?(i=d,k=i/j):(k=b,i=k*j),(i!=d||k!=b)&&(c.sx=~~((d-i)/2),c.sy=~~((b-k)/2),d=i,b=k)):k&&("min"==k?(g=f(j>i?e(d,g):h*i),h=f(j>i?g/i:e(b,h))):(g=f(i>=j?e(d,g):h*i),h=f(i>=j?g/i:e(b,h)))),c.sw=d,c.sh=b,c.dw=g,c.dh=h,c},_trans:function(a){this._load(this.file,function(b,c){b?a(b):this._apply(c,a)})},get:function(b){if(a.support.transform){var c=this;"auto"==c.matrix.deg?a.getInfo(this.file,function(a,d){c.matrix.deg=h[d&&d.exif&&d.exif.Orientation]||0,c._trans(b)}):c._trans(b)}else b("not_support")},toData:function(a){this.get(a)}},d.exifOrientation=h,d.transform=function(b,e,f,g){a.getInfo(b,function(h,i){var j={},k=a.queue(function(a){g(a,j)});h?k.fail():a.each(e,function(a,e){if(!k.isFail()){var g=d(i.nodeType?i:b);"function"==typeof a?a(i,g):a.width?g[a.preview?"preview":"resize"](a.width,a.height,a.type):a.maxWidth&&(i.width>a.maxWidth||i.height>a.maxHeight)&&g.resize(a.maxWidth,a.maxHeight,"max"),a.rotate===c&&f&&(a.rotate="auto"),g.rotate(a.rotate),k.inc(),g.toData(function(a,b){a?k.fail():(j[e]=b,k.next())})}})})},a.support.canvas=a.support.transform=g,a.Image=d}(FileAPI,document),function(a,b,c){var d=b.encodeURIComponent,e=b.FormData;b=function(){this.items=[]},b.prototype={append:function(a,b,c,d){this.items.push({name:a,blob:b&&b.blob||(void 0==b?"":b),file:b&&(c||b.name),type:b&&(d||b.type)})},each:function(a){for(var b=0,c=this.items.length;c>b;b++)a.call(this,this.items[b])},toData:function(b,c){c._chunked=a.support.chunked&&0<c.chunkSize&&1==a.filter(this.items,function(a){return a.file}).length,a.support.html5?this.multipart||!e?(a.log("FileAPI.Form.toMultipartData"),this.toMultipartData(b)):c._chunked?(a.log("FileAPI.Form.toPlainData"),this.toPlainData(b)):(a.log("FileAPI.Form.toFormData"),this.toFormData(b)):(a.log("FileAPI.Form.toHtmlData"),this.toHtmlData(b))},_to:function(b,c,d,e){var f=a.queue(function(){c(b)});this.each(function(a){d(a,b,f,e)}),f.check()},toHtmlData:function(b){this._to(c.createDocumentFragment(),b,function(b,d){var e,f=b.blob;b.file?(a.reset(f),f.name=b.name,d.appendChild(f)):(e=c.createElement("input"),e.name=b.name,e.type="hidden",e.value=f,d.appendChild(e))})},toPlainData:function(a){this._to({},a,function(a,b,c){a.file&&(b.type=a.file),a.blob.toBlob?(c.inc(),a.blob.toBlob(function(d){b.name=a.name,b.file=d,b.size=d.length,b.type=a.type,c.next()},"image/png")):a.file?(b.name=a.blob.name,b.file=a.blob,b.size=a.blob.size,b.type=a.type):(b.params||(b.params=[]),b.params.push(encodeURIComponent(a.name)+"="+encodeURIComponent(a.blob))),b.start=-1,b.end=b.file.FileAPIReadPosition||-1,b.retry=0})},toFormData:function(a){this._to(new e,a,function(a,b,c){a.file&&b.append("_"+a.name,a.file),a.blob&&a.blob.toBlob?(c.inc(),a.blob.toBlob(function(d){b.append(a.name,d,a.file),c.next()},"image/png")):a.file?b.append(a.name,a.blob,a.file):b.append(a.name,a.blob)})},toMultipartData:function(b){this._to([],b,function(b,c,e,f){var g=!!b.file,h=b.blob,i=function(a){c.push("--_"+f+('\r\nContent-Disposition: form-data; name="'+b.name+'"'+(g?'; filename="'+d(b.file)+'"':"")+(g?"\r\nContent-Type: "+(b.type||"application/octet-stream"):"")+"\r\n\r\n"+(g?a:d(a))+"\r\n")),e.next()};e.inc(),a.isFile(h)?a.readAsBinaryString(h,function(a){"load"==a.type&&i(a.result)}):i(h)},a.expando)}},a.Form=b}(FileAPI,window,document),function(a,b){var c=function(){},d=function(a){this.uid=b.uid(),this.xhr={abort:c,getResponseHeader:c,getAllResponseHeaders:c},this.options=a};d.prototype={status:0,statusText:"",getResponseHeader:function(a){return this.xhr.getResponseHeader(a)},getAllResponseHeaders:function(){return this.xhr.getAllResponseHeaders()||{}},end:function(d,e){var f=this,g=f.options;f.end=f.abort=c,f.status=d,e&&(f.statusText=e),b.log("xhr.end:",d,e),g.complete(200==d||201==d?!1:f.statusText||"unknown",f),f.xhr&&f.xhr.node&&setTimeout(function(){var b=f.xhr.node;try{b.parentNode.removeChild(b)}catch(c){}try{delete a[f.uid]}catch(d){}a[f.uid]=f.xhr.node=null},9)},abort:function(){this.end(0,"abort"),this.xhr&&(this.xhr.aborted=!0,this.xhr.abort())},send:function(a){var b=this,c=this.options;a.toData(function(a){c.upload(c,b),b._send.call(b,c,a)},c)},_send:function(c,d){var e,f=this,g=f.uid,h=c.url;b.log("XHR._send:",d),h+=(~h.indexOf("?")?"&":"?")+b.uid(),d.nodeName?(c.upload(c,f),e=document.createElement("div"),e.innerHTML='<form target="'+g+'" action="'+h+'" method="POST" enctype="multipart/form-data" style="position: absolute; top: -1000px; overflow: hidden; width: 1px; height: 1px;"><iframe name="'+g+'" src="javascript:false;"></iframe><input value="'+g+'" name="callback" type="hidden"/></form>',f.xhr.abort=function(){var a=e.getElementsByName("iframe")[0];if(a)try{a.stop?a.stop():a.contentWindow.stop?a.contentWindow.stop():a.contentWindow.document.execCommand("Stop")}catch(b){}e=null},h=e.getElementsByTagName("form")[0],h.appendChild(d),b.log(h.parentNode.innerHTML),document.body.appendChild(e),f.xhr.node=e,a[g]=function(a,b,c){f.readyState=4,f.responseText=c,f.end(a,b),e=null},f.readyState=2,h.submit(),h=null):this.xhr&&this.xhr.aborted?b.log("Error: already aborted"):(e=f.xhr=b.getXHR(),d.params&&(h+=(0>h.indexOf("?")?"?":"&")+d.params.join("&")),e.open("POST",h,!0),e.withCredential="true",(!c.headers||!c.headers["X-Requested-With"])&&e.setRequestHeader("X-Requested-With","XMLHttpRequest"),b.each(c.headers,function(a,b){e.setRequestHeader(b,a)}),c._chunked?(e.upload&&e.upload.addEventListener("progress",function(a){d.retry||c.progress({type:a.type,total:d.size,loaded:d.start+a.loaded,totalSize:d.size},f,c)},!1),e.onreadystatechange=function(){if(f.status=e.status,f.statusText=e.statusText,f.readyState=e.readyState,4==e.readyState){for(var a in{"":1,XML:1,Text:1,Body:1})f["response"+a]=e["response"+a];if(e.onreadystatechange=null,!e.status||0<e.status-201)if(b.log("Error: "+e.status),(!e.status&&!e.aborted||500==e.status||416==e.status)&&++d.retry<=c.chunkUploadRetry){a=e.status?0:b.chunkNetworkDownRetryTimeout,c.pause(d.file,c);var g=parseInt(e.getResponseHeader("X-Last-Known-Byte"),10);b.log("X-Last-Known-Byte: "+g),d.end=g?g:d.start-1,setTimeout(function(){f._send(c,d)},a)}else f.end(e.status);else d.retry=0,d.end==d.size-1?f.end(e.status):(g=parseInt(e.getResponseHeader("X-Last-Known-Byte"),10),b.log("X-Last-Known-Byte: "+g),g&&(d.end=g),d.file.FileAPIReadPosition=d.end,setTimeout(function(){f._send(c,d)},0));e=null}},d.start=d.end+1,d.end=Math.max(Math.min(d.start+c.chunkSize,d.size)-1,d.start),(g="slice")in d.file||(g="mozSlice")in d.file||(g="webkitSlice"),e.setRequestHeader("Content-Range","bytes "+d.start+"-"+d.end+"/"+d.size),e.setRequestHeader("Content-Disposition","attachment; filename="+encodeURIComponent(d.name)),e.setRequestHeader("Content-Type",d.type||"application/octet-stream"),g=d.file[g](d.start,d.end+1),e.send(g),g=null):(e.upload&&e.upload.addEventListener("progress",b.throttle(function(a){c.progress(a,f,c)},100),!1),e.onreadystatechange=function(){if(f.status=e.status,f.statusText=e.statusText,f.readyState=e.readyState,4==e.readyState){for(var a in{"":1,XML:1,Text:1,Body:1})f["response"+a]=e["response"+a];e.onreadystatechange=null,f.end(e.status),e=null}},b.isArray(d)?(e.setRequestHeader("Content-Type","multipart/form-data; boundary=_"+b.expando),d=d.join("")+"--_"+b.expando+"--",e.sendAsBinary?e.sendAsBinary(d):(g=Array.prototype.map.call(d,function(a){return 255&a.charCodeAt(0)}),e.send(new Uint8Array(g).buffer))):e.send(d)))}},b.XHR=d}(window,FileAPI),function(a,b,c){var d=a.support,e=b.navigator,f=e.mimeTypes,g=!1;if(e.plugins&&"object"==typeof e.plugins["Shockwave Flash"])g=e.plugins["Shockwave Flash"].description&&!(f&&f["application/x-shockwave-flash"]&&!f["application/x-shockwave-flash"].enabledPlugin);else try{g=!(!b.ActiveXObject||!new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))}catch(h){a.log("ShockwaveFlash.ShockwaveFlash -- does not supported.")}if(d.flash=g,a.support.flash&&(!a.html5||!a.support.html5||a.cors&&!a.support.cors)){var i=function(a){return('<object id="#id#" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+(a.width||"100%")+'" height="'+(a.height||"100%")+'"><param name="movie" value="#src#" /><param name="flashvars" value="#flashvars#" /><param name="swliveconnect" value="true" /><param name="allowscriptaccess" value="always" /><param name="allownetworking" value="all" /><param name="menu" value="false" /><param name="wmode" value="#wmode#" /><embed flashvars="#flashvars#" swliveconnect="true" allownetworking="all" allowscriptaccess="always" name="#id#" src="#src#" width="'+(a.width||"100%")+'" height="'+(a.height||"100%")+'" menu="false" wmode="transparent" type="application/x-shockwave-flash"></embed></object>').replace(/#(\w+)#/gi,function(b,c){return a[c]
})},j=function(a,b){if(a&&a.style){var c,d;for(c in b){d=b[c],"number"==typeof d&&(d+="px");try{a.style[c]=d}catch(e){}}}},k=function(b,c){a.each(c,function(a,c){var d=b[c];b[c]=function(){return this.parent=d,a.apply(this,arguments)}})},l=function(b){var c=b.wid=a.uid();return s._fn[c]=b,"FileAPI.Flash._fn."+c},m=function(a){try{s._fn[a.wid]=null,delete s._fn[a.wid]}catch(b){}},n=function(a,b){if(!r.test(a)){if(/^\.\//.test(a)||"/"!=a.charAt(0)){var c=location.pathname,c=c.substr(0,c.lastIndexOf("/"));a=(c+"/"+a).replace("/./","/")}"//"!=a.substr(0,2)&&(a="//"+location.host+a),r.test(a)||(a=location.protocol+a)}return b&&(a+=(/\?/.test(a)?"&":"?")+b),a},o=a.uid(),p=0,q={},r=/^https?:/i,s={_fn:{},init:function(){var b=c.body&&c.body.firstChild;if(b)do if(1==b.nodeType){a.log("FlashAPI.Flash.init...");var d=c.createElement("div");return j(d,{top:1,right:1,width:5,height:5,position:"absolute"}),b.parentNode.insertBefore(d,b),s.publish(d,o),void 0}while(b=b.nextSibling);10>p&&setTimeout(s.init,50*++p)},publish:function(b,c){b.innerHTML=i({id:c,src:n(a.flashUrl,"r="+a.version),wmode:"transparent",flashvars:"callback=FileAPI.Flash.event&flashId="+c+"&storeKey="+navigator.userAgent.match(/\d/gi).join("")+"_"+a.version+(s.isReady||(a.pingUrl?"&ping="+a.pingUrl:""))})},ready:function(){s.ready=a.F,s.isReady=!0,s.patch(),a.event.on(c,"mouseover",s.mouseover),a.event.on(c,"click",function(a){s.mouseover(a)&&(a.preventDefault?a.preventDefault():a.returnValue=!0)})},getWrapper:function(a){do if(/qiniu-js-wrapper/.test(a.className))return a;while((a=a.parentNode)&&a!==c.body)},mouseover:function(b){if(b=a.event.fix(b).target,/input/i.test(b.nodeName)&&"file"==b.type){var d=b.getAttribute(o);if("i"==d||"r"==d)return!1;if("p"!=d){b.setAttribute(o,"i");var d=c.createElement("div"),e=s.getWrapper(b);if(!e)return a.log("flash.mouseover.error: qiniu-js-wrapper not found"),void 0;j(d,{top:0,left:0,width:b.offsetWidth+5,height:b.offsetHeight+5,zIndex:"1000000",position:"absolute"}),e.appendChild(d),s.publish(d,a.uid()),b.setAttribute(o,"p")}return!0}},event:function(b){var c=b.type;if("ready"==c){try{s.getInput(b.flashId).setAttribute(o,"r")}catch(d){}return s.ready(),setTimeout(function(){s.mouseenter(b)},50),!0}"ping"===c?a.log("(flash -> js).ping:",[b.status,b.savedStatus],b.error):"log"===c?a.log("(flash -> js).log:",b.target):c in s&&setTimeout(function(){a.log("Flash.event."+b.type+":",b),s[c](b)},1)},mouseenter:function(b){var c=s.getInput(b.flashId);if(c){s.cmd(b,"multiple",null!=c.getAttribute("multiple"));var d=[],e={};a.each((c.getAttribute("accept")||"").split(/,\s*/),function(b){a.accept[b]&&a.each(a.accept[b].split(" "),function(a){e[a]=1})}),a.each(e,function(a,b){d.push(b)}),s.cmd(b,"accept",d.length?d.join(",")+","+d.join(",").toUpperCase():"*")}},get:function(a){return c[a]||b[a]||c.embeds[a]},getInput:function(b){try{var c=s.getWrapper(s.get(b));if(c)return c.getElementsByTagName("input")[0]}catch(d){a.log('Can not find "input" by flashId:',b,d)}},select:function(b){var d=s.getInput(b.flashId),e=a.uid(d);b=b.target.files,a.each(b,function(b){a.checkFileObj(b)}),q[e]=b,c.createEvent?(e=c.createEvent("Event"),e.initEvent("change",!0,!1),d.dispatchEvent(e)):c.createEventObject&&(e=c.createEventObject(),d.fireEvent("onchange",e))},cmd:function(b,c,d,e){try{return a.log("(js -> flash)."+c+":",d),s.get(b.flashId||b).cmd(c,d)}catch(f){a.log("(js -> flash).onError:",f),e||setTimeout(function(){s.cmd(b,c,d,!0)},50)}},patch:function(){a.flashEngine=a.support.transform=!0,k(a,{getFiles:function(b,c,d){if(d)return a.filterFiles(a.getFiles(b),c,d),null;var e=a.isArray(b)?b:q[a.uid(b.target||b.srcElement||b)];return e?(c&&(c=a.getFilesFilter(c),e=a.filter(e,function(a){return c.test(a.name)})),e):this.parent.apply(this,arguments)},getInfo:function(b,c){if(b&&!b.flashId)this.parent.apply(this,arguments);else{if(!b.__info){var d=b.__info=a.defer();s.cmd(b,"getFileInfo",{id:b.id,callback:l(function e(a,c){m(e),d.resolve(a,b.info=c)})})}b.__info.then(c)}}}),a.support.transform=!0,a.Image&&k(a.Image.prototype,{get:function(a,b){this.set({scaleMode:b||"noScale"}),this.parent(a)},_load:function(b,c){if(a.log("FileAPI.Image._load:",b),b&&!b.flashId)this.parent.apply(this,arguments);else{var d=this;a.getInfo(b,function(a){c.call(d,a,b)})}},_apply:function(b,d){if(a.log("FileAPI.Image._apply:",b),b&&!b.flashId)this.parent.apply(this,arguments);else{var e=this.getMatrix(b.info);s.cmd(b,"imageTransform",{id:b.id,matrix:e,callback:l(function f(g,h){if(a.log("FileAPI.Image._apply.callback:",g),m(f),g)d(g);else if(!a.support.dataURI||3e4<h.length){var k,o={width:e.deg%180?e.dh:e.dw,height:e.deg%180?e.dw:e.dh,scale:e.scaleMode},p=d,q=function(){try{s.get(r).setImage(h)}catch(b){a.log('flash.setImage -- can not set "base64":',b)}},r=a.uid(),t=c.createElement("div");for(k in o)t.setAttribute("data-img-"+k,o[k]);j(t,o),t.innerHTML=i(a.extend({id:r,src:n(a.flashImageUrl,"r="+a.uid()),wmode:"opaque",flashvars:"scale="+o.scale+"&callback="+l(function v(){return m(v),setTimeout(q,99),!0})},o)),p(!1,t),t=null}else{var u=new Image;a.event.one(u,"error abort load",function(a){d("load"!=a.type&&a.type,u),u=null}),u.src="data:"+b.type+";base64,"+h}})})}},toData:function(b){var c=this.file,d=c.info,e=this.getMatrix(d);c&&!c.flashId?this.parent.apply(this,arguments):("auto"==e.deg&&(e.deg=a.Image.exifOrientation[d&&d.exif&&d.exif.Orientation]||0),b.call(this,!c.info,{id:c.id,flashId:c.flashId,name:c.name,type:c.type,matrix:e}))}}),k(a.Form.prototype,{toData:function(b){for(var c=this.items,d=c.length;d--;)if(c[d].file&&c[d].blob&&!c[d].blob.flashId)return this.parent.apply(this,arguments);a.log("flash.Form.toData"),b(c)}}),k(a.XHR.prototype,{_send:function(b,c){if(c.nodeName||c.append&&a.support.html5||a.isArray(c)&&"string"==typeof c[0])return this.parent.apply(this,arguments);var d,e,f={},g={},h=this;if(a.each(c,function(a){a.file?(g[a.name]=a={id:a.blob.id,name:a.blob.name,matrix:a.blob.matrix,flashId:a.blob.flashId},e=a.id,d=a.flashId):f[a.name]=a.blob}),!e&&!d)return this.parent.apply(this,arguments);a.log("flash.XHR._send:",d,e,g),h.xhr={headers:{},abort:function(){s.cmd(d,"abort",{id:e})},getResponseHeader:function(a){return this.headers[a]},getAllResponseHeaders:function(){return this.headers}};var i=a.queue(function(){s.cmd(d,"upload",{url:n(b.url),data:f,files:g,headers:b.headers,callback:l(function c(d){var e=d.type,f=d.result;a.log("flash.upload."+e+":",d),"progress"==e?(d.loaded=Math.min(d.loaded,d.total),d.lengthComputable=!0,b.progress(d)):"complete"==e?(m(c),"string"==typeof f&&(h.responseText=f.replace(/%22/g,'"').replace(/%5c/g,"\\").replace(/%26/g,"&").replace(/%25/g,"%")),h.end(d.status||200)):("abort"==e||"error"==e)&&(h.end(d.status||0,d.message),m(c))})})});a.each(g,function(b){i.inc(),a.getInfo(b,i.next)}),i.check()}})}};a.Flash=s;var t=new Image;a.event.one(t,"error load",function(){a.support.dataURI=!(1!=t.width||1!=t.height),t=null,s.init()}),t.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="}}(FileAPI,window,document),"undefined"!=typeof ajs&&ajs.loaded&&ajs.loaded("{fileapi}FileAPI.min"),window.FileAPI}),def("qiniu.deps.shim",function(){function a(){return document.createElement("script")}function b(a){var b,c,d,e,f,h;for(d=a.length,c=0,b="";d>c;){if(e=255&a.charCodeAt(c++),c==d){b+=g.charAt(e>>2),b+=g.charAt((3&e)<<4),b+="==";break}if(f=a.charCodeAt(c++),c==d){b+=g.charAt(e>>2),b+=g.charAt((3&e)<<4|(240&f)>>4),b+=g.charAt((15&f)<<2),b+="=";break}h=a.charCodeAt(c++),b+=g.charAt(e>>2),b+=g.charAt((3&e)<<4|(240&f)>>4),b+=g.charAt((15&f)<<2|(192&h)>>6),b+=g.charAt(63&h)}return b}function c(a){var b,c,d,e,f,g,i;for(g=a.length,f=0,i="";g>f;){do b=h[255&a.charCodeAt(f++)];while(g>f&&-1==b);if(-1==b)break;do c=h[255&a.charCodeAt(f++)];while(g>f&&-1==c);if(-1==c)break;i+=String.fromCharCode(b<<2|(48&c)>>4);do{if(d=255&a.charCodeAt(f++),61==d)return i;d=h[d]}while(g>f&&-1==d);if(-1==d)break;i+=String.fromCharCode((15&c)<<4|(60&d)>>2);do{if(e=255&a.charCodeAt(f++),61==e)return i;e=h[e]}while(g>f&&-1==e);if(-1==e)break;i+=String.fromCharCode((3&d)<<6|e)}return i}var d=document.getElementsByTagName("script")[0],e=d.parentNode;if(!window.JSON){var f=a();f.src="//cdn.staticfile.org/json2/20121008/json2.min.js",e.insertBefore(f,d)}if(!window.atob&&!window.btoa){var g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1];window.btoa=b,window.atob=c}}),def("qiniu.Asset",["qiniu.utils","qiniu.Fop"],function(a,b,c){function d(a,b,c){this.key=a,this.parent=b,this.config=c||{}}function e(){return!1}var f={};if("undefined"!=typeof define&&define.amd)var g=arguments[0],h=arguments[1];else var g=a("qiniu.utils"),h=a("qiniu.Fop");return d.prototype.url=function(){return g.format("http://%s.qiniudn.com/%s",this.parent.name,this.key)},d.prototype.entryUrl=function(){return g.safeEncode(g.format("%s:%s",this.parent.name,this.key))},d.prototype.qrcode=function(a,b){switch(!0){case g.isFunction(a):b=a,a={mode:0,level:"L"};break;case g.isObject(a)&&g.isUndefined(b):b=e;break;case g.isUndefined(a):a={mode:0,level:"L"},b=e}var c=g.format("%s?qrcode/%d/level/%s",this.url(),a.mode,a.level),d=new Image;return d.src=d.url=c,d},d.prototype.fop=function(a){return new h(this,a)},d.prototype.alias=function(a){var b=this.url();return b+=g.format("%s%s",this.config.separate,a)},d.prototype.md2html=function(a){g.isFunction(a)?(callback=a,a={mode:!1,css:!1}):g.isObject(a)?callback=callback||e:(callback=callback||e,a={mode:!1,css:!1});var b=this.url()+"?md2html";a.mode&&(b+=g.format("/%s",a.mode)),a.css&&(b+=g.format("/css/%s",g.safeEncode(a.css)));var c=new Image;return c.src=b,c},c.exports=b=function(a){return f=a,d}}),def("qiniu.Image",["qiniu.Asset","qiniu.utils","qiniu.deps.Events","qiniu.deps.file","qiniu.deps.Ajax"],function(a,b,c){function d(a,b,c){var d=h.objExtend(h.objClone(b.config),{separate:"-"},c);this.key=a,this.parent=b,this.config=d}function e(a){var b="";return h.each(a,function(a,c){b+=h.format("/%s/%s",c,a)}),b}function f(){return!1}if("undefined"!=typeof define&&define.amd)var g=arguments[0],h=arguments[1],i=arguments[2],j=arguments[3],k=arguments[4];else var g=a("qiniu.Asset")({}),h=a("qiniu.utils"),i=a("qiniu.deps.Events"),j=a("qiniu.deps.file"),k=a("qiniu.deps.Ajax");i.EventEmitter;var l=i.Promise;h.inherits(d,g),d.prototype.imageInfo=function(a){var b=new l;a=a||f;var c=this.url()+"?imageInfo";return k.get(c,function(c,d){if(c)return b.reject(c),a(c);var e=JSON.parse(d);b.resolve(e),a(null,e)}),b},d.prototype.exif=function(a){var b=new l;a=a||f;var c=this.url()+"?exif";return k.get(c,function(c,d){if(c)return b.reject(c),a(c);var e=JSON.parse(d);b.resolve(e),a(null,e)}),b};var m={weight:"w",height:"h",quality:"q"};return d.prototype.imageView=function(a,b){var c=new l;b=b||f;var d=a.mode;delete a.mode;var g=this.url(),i={};h.each(a,function(a,b){m.hasOwnProperty(b)&&(b=m[b]),i[b]=a}),g+=h.format("?imageView/%d%s",d,e(i));var j=new Image;return j.src=g,c.image=j,c.resolve(j),c},d.prototype.imageMogr=function(a){var b=new l,c=this.url(),d={};h.objExtend(d,a),c+=h.format("?imageMogr/v2/auto-orient%s",e(d));var f=new Image;return f.src=c,b.image=f,b.resolve(f),b},d.prototype.watermark=function(a,b){var c=new l;b=b||f;var d=this.url(),g={},i=a.mode;delete a.mode,h.objExtend(g,a),g.image=h.safeEncode(g.image),d+=h.format("?watermark/%d%s",i,e(g));var j=new Image;return j.src=d,c.image=j,c.resolve(j),c},d.extend=function(a){return a.imageView=function(a,b){var c=new i.Promise;b=b||f;var d=j.Image(this);return d._load(this,function(e,f){if(e)return b(e),c.reject(e);var g={};switch(a.mode=a.mode||1,a.mode){case 1:h.objExtend(g,{dw:a.width||a.height,dh:a.height||a.width,resize:"preview"});break;case 2:var i=f.width/f.height,j=a.hasOwnProperty("width"),k=a.hasOwnProperty("height");switch(!0){case j&&k:h.objExtend(g,{dw:a.width,dh:a.height,resize:"max"});break;case j&&!k:h.objExtend(g,{dw:a.width,dh:a.width/i,resize:"max"});break;case!j&&k:h.objExtend(g,{dw:a.height*i,dh:a.height,resize:"max"})}}d.set(g).get(function(a,d){return a?(b(a),c.reject(a)):(b(null,d),c.resolve(d),void 0)})}),c},a.imageMogr=function(a,b){var c=new i.Promise;b=b||f;var d=j.Image(this);return d._load(this,function(e,f){if(e)return b(null),c.reject(e);var g={},i=f.width/f.height,j=a.thumbnail;switch(j.mode){case 1:h.objExtend(g,{dw:j.width||j.height,dh:j.height||j.width,resize:"preview",sx:(f.width-j.width)/2,sy:(f.height-j.height)/2,sw:j.width||j.height,sh:j.height||j.width});break;case 2:var k=j.hasOwnProperty("width"),l=j.hasOwnProperty("height");switch(!0){case k&&l:h.objExtend(g,{dw:j.width,dh:j.height,resize:"max"});break;case k&&!l:h.objExtend(g,{dw:j.width,dh:j.width/i,resize:"max"});break;case!k&&l:h.objExtend(g,{dw:j.height*i,dh:j.height,resize:"max"})}}var m=a.crop,n=m.hasOwnProperty("width"),o=m.hasOwnProperty("height");switch(m.x=m.x||0,m.y=m.y||0,m.gravity,!0){case n&&!o:m.height=m.width/i;break;case!n&&o:m.width=m.height*i}m.rotate=m.rotate||0,h.objExtend(g,{sx:m.x,sy:m.y,sw:m.width,sh:m.height,deg:m.rotate}),d.set(g).get(function(a,d){return a?(b(a),c.reject(a)):(b(null,d),c.resolve(d),void 0)})}),c},a.imageInfo=function(a){var b=new i.Promise;a=a||f;var c=j.Image(this);return c._load(this,function(c,d){if(c)return a(c),b.reject(c);var e={width:d.width,height:d.height};a(null,e),b.resolve(e)}),b},a.image=function(){return j.Image(this)},a},c.exports=b=d}),def("qiniu.Bucket",["qiniu.Asset","qiniu.Image","qiniu.utils","qiniu.deps.file","qiniu.deps.Events","qiniu.deps.Ajax"],function(require,exports,module){function Bucket(a,b){b=b||{},this.name=a,this.queue=[],this.config=utils.objExtend(globalConfig,b,{scope:a})}function noop(){return!1}if("undefined"!=typeof define&&define.amd)var Asset=arguments[0],_Image=arguments[1],utils=arguments[2],file=arguments[3],events=arguments[4],ajax=arguments[5];else var Asset=require("qiniu.Asset"),_Image=require("qiniu.Image"),utils=require("qiniu.utils"),file=require("qiniu.deps.file"),events=require("qiniu.deps.Events"),ajax=require("qiniu.deps.Ajax");var globalConfig=null;return window.BlobBuilder=window.MozBlobBuilder||window.WebKitBlobBuilder||window.BlobBuilder||!1,Bucket.prototype.putFile=function(a,b,c,d){var e=new events.Promise,f=this;switch(arguments.length){case 3:utils.isFunction(c)?(d=c,c={}):d=noop;break;case 2:c={},d=noop}utils.objExtend(utils.objClone(this.config),c);var g=this.config.putToken,h="http://"+globalConfig.uploadUrl,i=file.upload({url:h,data:{token:g,key:a},files:{file:b},upload:function(d){(c.before&&utils.isFunction(c.before)?c.before:noop).call(null,d,a,b),e.emit("before",d,a,file)},progress:function(a){var b=100*(a.loaded/a.total);(c.progress&&utils.isFunction(c.progress)?c.progress:noop).call(null,b,a.loaded,a.total),e.emit("progress",b,a.loaded,a.total)},complete:function(b,c){if(b)return d(b),e.reject(b);if(window.JSON)var g=JSON.parse(i.responseText);else var g=i.responseText;var h=f.key(a);d(null,g,h,i,c),e.resolve(g,h,i,c),e.emit("complete",g,h,i,c)}});return e},Bucket.prototype.putChunkedFile=function(key,_file,options,callback){var promise=new events.Promise,self=this,config=utils.objExtend(utils.objClone(this.config),options),putToken=this.config.putToken;options.blockSize=options.blockSize||file.MB.form(5);var uploadUrl="http://"+globalConfig.uploadUrl+"/mkblk/"+options.blockSize,blockCtxes=[];if(utils.isFunction(_file.slice))!function loop(url,start,_callback,host){var end=start+options.blockSize;if(!(start<_file.size))return _callback(host);var blob=_file.slice(start,end);ajax.postBlob(url,blob,{headers:{"Content-Type":"application/octet-stream",Authorization:utils.format("UpToken %s",putToken)}},function(err,reply){if(err)return callback(err),promise.reject(err);var replyData=eval(reply);blockCtxes.push(replyData.ctx);var host=replyData.host;loop(utils.format("%s/bput/%s/%s",host,replyData.ctx,end),end,_callback,host)})}(uploadUrl,0,function(a){var b=self.key(key),c=utils.format("%s/rs-mkfile/%s/fsize/%s/mimeType/%s",a,b.entryUrl(),_file.size,_file.type);options.params&&utils.format("/params/%s"),options.meta&&(c+=utils.format("/meta/%s",utils.safeEncode(options.meta))),options.customer&&(c+=utils.format("/customer/%s",options.customer)),options.rotate&&(c+=utils.format("/rotate/%s",options.rotate)),ajax.post()});else{var err="no support chunk";promise.reject(err),callback(err)}return promise},Bucket.prototype.getFile=function(a,b){var c=this.config.getToken,d=new events.Promise;b=b||noop;var e=utils.format("http://%s.qiniudn.com/%s?e=3600&token=%s",this.name,a,c);return ajax.get(e,function(a,c){return a?(b(a),d.reject(a)):(b(null,c),d.resolve(c),void 0)}),d.promise},Bucket.prototype.key=function(a){return new Asset(a,this)},Bucket.Asset=Asset,Bucket.prototype.image=function(a){return new _Image(a,this)},Bucket.Image=_Image,module.exports=exports=function(a){return globalConfig=a,Asset=Asset(a),Bucket}}),def("qiniu.Fop",["qiniu.utils"],function(a,b,c){function d(a,b){this.parent=a,this.config=e.objExtend(e.objClone(config),b),this.query=""}if("undefined"!=typeof define&&define.amd)var e=arguments[0];else if(a instanceof Function)var e=a("qiniu.utils");d.prototype.fop=function(a){return this.query+="|"+a,this},d.prototype.imageInfo=function(){return this.query+="|imageInfo",this},d.prototype.exif=function(){return this.query+="|exif",this};var f={weight:"w",height:"h",quality:"q"};return d.prototype.imageView=function(a){var b=a.mode;delete a.mode,this.url();var c={};return e.each(a,function(a,b){f.hasOwnProperty(b)&&(b=f[b]),c[b]=a}),this.query+=e.format("|imageView/%d%s",b,genOptUrl(c)),this},d.prototype.imageMogr=function(a){var b={};return e.objExtend(b,a),this.query+=e.format("|imageMogr/v2/auto-orient%s",genOptUrl(b)),this},d.prototype.watermark=function(a){var b={},c=a.mode;return delete a.mode,e.objExtend(b,a),b.image=e.safeEncode(b.image),this.query+=e.format("|watermark/%d%s",c,genOptUrl(b)),this},d.prototype.qrcode=function(a){return a=a||{mode:0,level:"L"},this.query+=e.format("|qrcode/%d/level/%s",this.url(),a.mode,a.level),this},d.prototype.md2html=function(a){a=a||{mode:!1,css:!1};var b="|md2html";return a.css&&(b+=e.format("/%s",a.mode)),a.css&&(b+=e.format("/css/%s",e.safeEncode(a.css))),this.query+=b,this},d.prototype.url=function(){return e.format("%s?%s",this.parent.url(),this.query.substr(1))},d.prototype.image=function(){var a=new Image;return a.src=this.url(),a},c.exports=b=d,d}),def("qiniu",["qiniu.Asset","qiniu.Bucket","qiniu.Image","qiniu.utils","qiniu.deps.Events","qiniu.deps.shim","qiniu.deps.file","qiniu.deps.Ajax"],function(a,b){function c(){return!1}var d={uploadUrl:"up.qiniu.com",rsUrl:"rs.qbox.me",rsfUrl:"rsf.qbox.me"};if("undefined"!=typeof define&&define.amd){var e=arguments[0](d),f=arguments[1](d),g=arguments[2],h=arguments[3],i=arguments[4],j=arguments[6];arguments[7]}else{var e=a("qiniu.Asset")(d),f=a("qiniu.Bucket")(d),g=a("qiniu.Image"),h=a("qiniu.utils"),i=a("qiniu.deps.Events"),j=a("qiniu.deps.file");a("qiniu.deps.Ajax")}var k=b;return k.config=function(a,b){if(arguments.length>1&&a instanceof String)k.set(a,b);else switch(!0){case h.isString(a):return k.get(a);case h.isObject(a):for(var c in a)!function(b){k.set(b,a[b])}(c)}return this},k.set=function(a,b){return d[a]=b,this},k.get=function(a){return d[a]},k.bind=function(a,b){b=b||{};var c=".qiniu-transparent {       zoom: 1;       opacity: 0;       -moz-opacity: 0;       -khtml-opacity: 0;       filter: 'alpha(opacity=0)';       *filter: alpha(opacity=0);     }",d=document.getElementsByTagName("head")[0],e=document.createElement("style");e.type="text/css",e.styleSheet?e.styleSheet.cssText=c:e.appendChild(document.createTextNode(c)),d.appendChild(e);var f=document.createElement("div"),i='<span class="qiniu-js-wrapper qiniu-transparent"></span>';f.innerHTML=i;var l=f.firstChild;if(a.jquery)a.before(l).addClass("select-btn");else{var m=a.parentNode;m.insertBefore(l,a)}var n=document.createElement("input");return n.type="file",n.className="qiniu-transparent",n.multiple=!0,l.appendChild(n),a=a.jquery?a.get(0):a,h.css(l,{top:a.style.top,right:a.style.right,position:"absolute",width:a.offsetWidth+5,height:a.offsetHeight+5,margin:a.style.margin}),h.css(n,{width:a.offsetWidth+5,height:a.offsetHeight+5,position:"relative"}),j.event.on(n,"change",function(a){var c=j.getFiles(a),d=b.filter||!1,e={image:/image/,audio:/audio/,video:/video/,media:/audio|video/};switch(!0){case h.isString(d):e[d]&&(c=j.filter(c,function(a){return e[d].test(a.type)}));break;case h.isArray(d):for(var f=0;f<d.length;f++)!function(a){c=j.filter(c,function(b){return e[d[a]].test(b.type)})}(f);break;case d instanceof RegExp:c=j.filter(c,function(a){return d.test(a.type)})}for(var f=0;f<c.length;f++)!function(a){k.emit("file",g.extend(c[a]))}(f)}),this},k.bind.dnd=function(a,b){return j.support.dnd?(j.event.dnd(a.jquery?a.get(0):a,function(a){var c=b.filter||!1,d={image:/image/,audio:/audio/,video:/video/,media:/audio|video/};switch(!0){case h.isString(c):d[c]&&(a=j.filter(a,function(a){return d[c].test(a.type)}));break;case h.isArray(c):for(var e=0;e<c.length;e++)!function(b){a=j.filter(a,function(a){return d[c[b]].test(a.type)})}(e);break;case c instanceof RegExp:a=j.filter(a,function(a){return c.test(a.type)})}for(var e=0;e<a.length;e++)!function(b){k.emit("file",g.extend(a[b]))}(e)}),j.event.on(a.jquery?a.get(0):a,"dragover dragleave",function(a){switch(a.type){case"dragover":(b.over&&h.isFunction(b.over)?b.over:c).call(null),k.emit("over");break;case"dragleave":(b.out&&h.isFunction(b.out)?b.out:c).call(null),k.emit("out")}}),(b.success&&h.isFunction(b.success)?b.success:c).call(null),k.emit("dnd.success")):(k.emit("dnd.error","no support"),(b.error&&h.isFunction(b.error)?b.error:c).call(null,"no support")),k},k.supportDnd=j.support.dnd,k.bucket=function(a,b){return new f(a,b)},k.Asset=e,k.Bucket=f,k.Image=g,h.objExtend(k,i.EventEmitter.prototype),i.EventEmitter.call(k),k});